---
title: "Cover Crop Data Analysis"
author: "Hayley Brackenridge"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: simplex
    highlight: tango
    toc: TRUE
    toc_depth: 4
---

#Preamble

This markdown contains analysis of data from the Roller-Crimper project conducted in Agassiz BC, St-Jean-sur-Richelieu QC, and Harrow ON in 2019, 2020, and 2021.

#VAR

## Load datasets

There are two data files from this project.

The first, named dat, contains rye stand counts, rye anthesis, rye biomass, rye tillers, rye stem diameter, rye mortality & pop ups after crimping, sweet corn stand, sweet corn height, sweet corn injury, sweet corn VT date, and sweet corn yield for only the core 8 treatments -> W & WF no rye, W rye (no WF rye or 2N).

datw is a version of dat that contains WF treatments for all rye treatments (uneven treatment numbers across locations & years).
datr is a version of datw that contains only rye treatments, no controls.

The second data file, named wdat, contains weed measurement timing, quadrat, count, stage, and biomass. 


```{r load VAR datasets, results='hide', message=FALSE, warning=FALSE, 'load-data-&-packages'}
# load datasets
dat<- read.csv("VAR_All.csv")
str(dat) # view data variables & adjust type as necessary
dat$Plot<- as.factor(dat$Plot)
dat$Rep<- as.factor(dat$Rep)
dat$SR<- as.factor(dat$SR)
dat$VT_date<- as.Date(dat$VT_date, "%Y-%m-%d")
dat$VT_date<- format(dat$VT_date, "%j")
dat$VT_date<- as.integer(dat$VT_date, "%j")
dat$anthesis<- as.Date(dat$anthesis, "%Y-%m-%d")
dat$anthesis<- format(dat$anthesis, "%j")
dat$anthesis<- as.integer(dat$anthesis, "%j")

dat<- subset(dat, Nitro=="1") # remove 2N trt
dattrt<- subset(dat, !is.na(dat$Cult)) # dattrt contains only trt plots (no ctrls)

# WF data
datwf<- subset(dat, Weediness=="WF") # datwf contains only WF trts & ctrls
datwftrt<- subset(datwf, !is.na(datwf$Cult)) # datwftrt contains only WF trt plots (no ctrls)

# W data
datw<- subset(dat, Trt_num<9) # datw does not contain WF rye trts
datwtrt<- subset(datw, !(is.na(datw$Cult))) # datwtrt contains only weedy trt plots (no ctrls)

# StJean data w/ W/WF factor
Sdatw<- subset(dattrt, Year!="2019"&Location=="StJean") # subset for only StJean data in 2020 & 2021
Sdatw<- subset(Sdatw, Trt_num==4 | Trt_num==7 | Trt_num==11 | Trt_num==14) # subset for only plots w/ W/WF factor
Sdatw1<- subset(Sdatw, Year=="2020") # contains both cultivars
Sdatw2<- subset(Sdatw, Year=="2021") # contains Std only

# Harrow data w/ W/WF factor
Hdatw<- subset(dattrt, Location=="Harrow"&Year!="2019") # subset for only Harrow data in 2020 & 2021
Hdatw1<- subset(Hdatw, SR=="600") # subset for only H SR to compliment StJean data 2020
Hdatw2<- subset(Hdatw1, Cult=="Standard") # subset for only Std to compliment StJean data 2021

# combine Harrow & StJean data
datw1<- rbind(Hdatw1, Sdatw1) # contains both Harrow & StJean data w/ W/WF factor for S & E @ 600
datw2<- rbind(Hdatw2, Sdatw2) # contains both Harrow & StJean data w/ W/WF factor for S @ 600

# Harrow data WF
Hdatwf<- subset(datwf, Location=="Harrow"&Year!="2019")
Hdatwf1<- subset(Hdatwf, SR=="600"|is.na(Hdatwf$SR))
Hdatwf2<- subset(Hdatwf1, Cult!="Early"|is.na(Hdatwf1$Cult))

# StJean data WF
Sdatwf<- subset(datwf, Year!="2019"&Location=="StJean")
Sdatwf1<- subset(Sdatwf, Year=="2020") # contains both cultivars
Sdatwf2<- subset(Sdatwf, Year=="2021") # contains Std only

# combine Harrow & StJean WF data
datwf1<- rbind(Hdatwf1, Sdatwf1) # contains both Harrow & StJean WF data for both cult @ 600 
datwf2<- rbind(Hdatwf2, Sdatwf2) # contains both Harrow & StJean WF data for S 600

# Harrow data WF trts
Hdatwftrt<- subset(datwftrt, Location=="Harrow"&Year!="2019")
Hdatwftrt1<- subset(Hdatwftrt, SR=="600")
Hdatwftrt2<- subset(Hdatwftrt1, Cult=="Standard")

# StJean data WF trts
Sdatwftrt<- subset(datwftrt, Location=="StJean"&Year!="2019")
Sdatwftrt1<- subset(Sdatwftrt, Year=="2020")
Sdatwftrt2<- subset(Sdatwftrt, Year=="2021")

# combine Harrow & StJean WF trt data
datwftrt1<- rbind(Hdatwftrt1, Sdatwftrt1)
datwftrt2<- rbind(Hdatwftrt2, Sdatwftrt2)
```
```{r load VAR weeds data}
wdat<- read.csv("VAR_Weeds_Reduced.csv")
str(wdat) # view data variables & adjust type as necessary
wdat$Plot<- as.factor(wdat$Plot)
wdat$Rep<- as.factor(wdat$Rep)
wdat$Trt_num<- as.factor(wdat$Trt_num)
wdat$SR<- as.factor(wdat$SR)

wdat<- subset(wdat, Nitro=="1")

wdattrt<- subset(wdat, !is.na(wdat$Cult)) # dattrt contains only trt plots (no ctrls)
```
```{r load packages}
# load packages
library(ggplot2)
library(dplyr)
library(car)
library(lme4)
library(lmerTest)
library(ggpubr)
library(lsmeans)
library(emmeans)
```

The data was subsetted to only include the treatment Nitrogen = 1X


## Analysis

For each variable, a graph was created plotting the variable against cultivar, coloured by seeding rate, and facetted by location & year. This was to get a general sense of the trends in the data & look for any anomalies or potential errors.

From there, a full model was created with cultivar, seeding rate, and location as fixed effects, and rep & year as random effects to test whether the treatments were different from the control. 

The full model was reduced using the function `lmerTest::step()` which applies a backward model reduction approach using the Satterthwaite degrees of freedom method. This function does **not** work on `glmer()` so those required manual reduction.

The simplified model was resaved as `model.x.best`.

A summary table and anova table of the best model was produced to obtain p-values for each fixed effect. 

Model assumptions were tested using a Shapiro-Wilk Test and by visual inspection of the following diagnostic plots of residuals: Predicted vs Actual Residuals, Histogram of Residuals, and Q-Q Plot. 

If model assumptions were not well met, a note has been added and I will further investigate whether a transformation is needed.

If model assumptions were met, `emmeans()` was used to compare treatment & control means.

Then, the control was dropped and the model ran again to test the differences between treatments. 

The process of model reduction, assumption testing, & means comparisons was repeated for the treatment model.


Statistical design is an incomplete RBD with cultivar & seeding rate as factorial, weedy & weed-free no rye plots, & weed-free rye plots for some treatments at some locations. The model is:

Y = $\mu$ + block + cult * SR + (1 | Year / Rep) + (1 | Location / Rep) + e



### Rye biomass

```{r rye biomass graphs}
datwtrt$Rye_wt

# plot of rye biomass by cultivar & seeding rate, separated by location & year
ryewtplot1<- ggplot(subset(datwtrt, Cult=="Standard"|Cult=="Early"), aes(x = SR, y = Rye_wt, fill=Cult)) +
          geom_boxplot() +
          facet_wrap(Year~Location)+
          theme_bw()
print(ryewtplot1)
```

```{r rye biomass analysis}
# model analysis for rye biomass
model.ryewt<- lmer(Rye_wt ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.ryewt)
anova(model.ryewt)

model.ryewt.best<- get_model(lmerTest::step(model.ryewt, reduce.random=F))
summary(model.ryewt.best)
anova(model.ryewt.best)

# check residuals
resid.model.ryewt<- resid(model.ryewt.best)
pred.model.ryewt<- predict(model.ryewt.best)

# check randomness
plot(pred.model.ryewt, resid.model.ryewt, ylab="Residuals", xlab="Rye Weight", main="Predictecd vs Residuals")

# check normality
hist(resid.model.ryewt, main="Histogram of Residuals", xlab="Rye wt")

qqnorm(resid.model.ryewt) 

# Shapiro-Wilk test
shapiro.test(resid.model.ryewt)
# test assumptions fine

# means
ryewtemmeans<- emmeans(model.ryewt.best, pairwise ~ SR)
ryewtemmeans # 600 > 150, 300 > 150, 300 & 600 not different
plot(ryewtemmeans, comparisons=T)
```
*Best Model:*
Rye_wt ~ SR + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
   Sum Sq Mean Sq NumDF  DenDF F value  Pr(>F)  
SR  18897  9448.3     2 156.37  3.0613 0.04965 *

*Assumptions:*
Fine

*Means:*
 SR  emmean   SE   df lower.CL upper.CL
 150    172 10.6 4.13      143      201
 300    194 10.6 4.13      165      223
 600    195 10.7 4.20      166      224

*Contrasts:*
contrast  estimate   SE  df t.ratio p.value
 150 - 300   -21.53 10.3 154 -2.087  0.0959 
 150 - 600   -22.71 10.4 154 -2.191  0.0759 
 300 - 600    -1.19 10.4 154 -0.114  0.9928

### Rye tillers

```{r rye tillers graphs}
datwtrt$TAv

# plot of rye tillers by cultivar & seeding rate, separated by location & year
tillplot1<- ggplot(subset(datwtrt, Cult=="Standard"|Cult=="Early"), aes(x = Cult, y = TAv, fill=factor(SR))) +
          geom_boxplot() +
          facet_wrap(Year~Location)+
          theme_bw()
print(tillplot1)
# huge outlier -- St Jean 2019 plot 307 (TAv = 14.333)
```

```{r rye tiller analysis}
# model analysis for rye tillering
model.till<- lmer(TAv ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.till)
anova(model.till)

model.till.best<- get_model(lmerTest::step(model.till, reduce.random=F))
summary(model.till.best)
anova(model.till.best)

# check residuals
resid.model.till<- resid(model.till.best)
pred.model.till<- predict(model.till.best)

# check randomness
plot(pred.model.till, resid.model.till, ylab="Residuals", xlab="Rye tillers", main="Predictecd vs Residuals")

# check normality
hist(resid.model.till, main="Histogram of Residuals", xlab="Rye tillers")
# one value very far to right -> outlier from St Jean 2019 307?

qqnorm(resid.model.till) 

# Shapiro-Wilk test
shapiro.test(resid.model.till)
# test assumptions not okay -> try removing outlier


## hard-removing outlier as quick fix, saving under different dataframe
### large datpoint at StJean 2019 307 TAv=14
max(datwtrt$TAv, na.rm=T)
Toutlier.rm<- datwtrt[-c(grep("14", datwtrt$TAv)),]
# check that data point doesn't exist in new dataset
grep("14", Toutlier.rm$TAv)


# redo above analysis without StJean 2019 307 outlier
# plot of rye tillers by cultivar & seeding rate, separated by location & year
tillplot2<- ggplot(subset(Toutlier.rm, Cult=="Standard"|Cult=="Early"), aes(x = Cult, y = TAv, fill=factor(SR))) +
          geom_boxplot() +
          facet_wrap(Year~Location)+
          theme_bw()
print(tillplot2)
# still  some outliers in Harrow 2020 & 2019 data

# model analysis for rye tillering
model.till2<- lmer(TAv ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=Toutlier.rm)
summary(model.till2)
anova(model.till2)

model.till.best2<- get_model(lmerTest::step(model.till2, reduce.random=F))
summary(model.till.best2)
anova(model.till.best2)

# check residuals
resid.model.till2<- resid(model.till.best2)
pred.model.till2<- predict(model.till.best2)

# check randomness
plot(pred.model.till2, resid.model.till2, ylab="Residuals", xlab="Rye tillers", main="Predictecd vs Residuals")

# check normality
hist(resid.model.till2, main="Histogram of Residuals", xlab="Rye tillers")

qqnorm(resid.model.till2) 

# Shapiro-Wilk test
shapiro.test(resid.model.till2)
# test assumptions fine

tillemmeans<- emmeans(model.till.best2, pairwise ~ SR)
tillemmeans
plot(tillemmeans, comparisons=T)
```
*Best model:*
TAv ~ SR + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
   Sum Sq Mean Sq NumDF  DenDF F value   Pr(>F)    
SR 40.795  20.397     2 148.97   10.18 7.18e-05 ***

*Assumptions:*
Fine

*Means:*
 SR  emmean    SE   df lower.CL upper.CL
 150   4.82 0.512 4.22     3.43     6.22
 300   4.06 0.513 4.25     2.67     5.45
 600   3.58 0.514 4.27     2.19     4.97

*Contrasts:*
 contrast  estimate    SE  df t.ratio p.value
 150 - 300    0.761 0.277 138 2.750   0.0184 *
 150 - 600    1.241 0.278 138 4.465   <.0001 *
 300 - 600    0.480 0.279 138 1.720   0.2015 


### Rye stem diameter

```{r rye stem diam}
datwtrt$DiamAv

# plot of rye stem diameter by cultivar & seeding rate, separated by year, Harrow only
diamdat<- subset(datwtrt, Location=="Harrow") # subset data to only include Harrow b/c diameter only measured in Harrow
diamplot1<- ggplot(subset(diamdat, Cult=="Standard"|Cult=="Early"), aes(x = Cult, y = DiamAv, fill=factor(SR))) +
          geom_boxplot() +
          facet_wrap(~Year, ncol=1)+
          theme_bw()
print(diamplot1)

# model analysis for rye stem diameter
model.diam<- lmer(DiamAv ~ Cult * SR + (1 | Year / Rep), data=diamdat)
summary(model.diam)
anova(model.diam)

model.diam.best<- get_model(lmerTest::step(model.diam, reduce.random=F))
summary(model.diam.best)
anova(model.diam.best)

# check residuals
resid.model.diam<- resid(model.diam.best)
pred.model.diam<- predict(model.diam.best)

# check randomness
plot(pred.model.diam, resid.model.diam, ylab="Residuals", xlab="Rye stem diameter", main="Predictecd vs Residuals")

# check normality
hist(resid.model.diam, main="Histogram of Residuals", xlab="Rye stem diameter")

qqnorm(resid.model.diam) 

# Shapiro-Wilk test
shapiro.test(resid.model.diam)
# assumptions fine

diamemmeans1<- emmeans(model.diam.best, pairwise ~ Cult)
diamemmeans1
plot(diamemmeans1, comparisons=T)

diamemmeans2<- emmeans(model.diam.best, pairwise ~ SR)
diamemmeans2
plot(diamemmeans2, comparisons=T)
```
*Best Model:*
DiamAv ~ Cult + SR + (1 | Year/Rep)

*Effects:*
      Sum Sq Mean Sq NumDF DenDF F value    Pr(>F)    
Cult 12.2967 12.2967     1    57 116.728 2.047e-15 ***
SR    2.7929  1.3964     2    57  13.256 1.873e-05 ***

*Assumptions:*
Possible outlier on lower end but fine

*Means:*
 Cult     emmean   SE   df lower.CL upper.CL
 Early      3.83 0.36 2.05     2.32     5.35
 Standard   4.66 0.36 2.05     3.14     6.18
 
  SR  emmean    SE   df lower.CL upper.CL
 150   4.45 0.363 2.09     2.95     5.94
 300   4.31 0.363 2.09     2.82     5.81
 600   3.98 0.363 2.09     2.48     5.48

*Contrasts:*
 contrast         estimate     SE df t.ratio p.value
 Early - Standard   -0.827 0.0765 57 -10.804 <.0001 *

 contrast  estimate     SE df t.ratio p.value
 150 - 300    0.135 0.0937 57 1.442   0.3266 
 150 - 600    0.469 0.0937 57 5.002   <.0001 *
 300 - 600    0.334 0.0937 57 3.560   0.0022 *

### Rye anthesis
```{r rye anthesis}
datwtrt$anthesis

anthplot1<- ggplot(datwtrt, aes(x = Cult, y = anthesis, colour=factor(Location))) +
          geom_point() +
          facet_wrap(~Year)+
          theme_bw()
print(anthplot1)

# model analysis for rye stem diameter
model.anth<- lmer(anthesis ~ Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.anth)
anova(model.anth)

model.anth.best<- get_model(lmerTest::step(model.anth, reduce.random=F))
summary(model.anth.best)
anova(model.anth.best)

# check residuals
resid.model.anth<- resid(model.anth.best)
pred.model.anth<- predict(model.anth.best)

# check randomness
plot(pred.model.anth, resid.model.anth, ylab="Residuals", xlab="Rye stem diameter", main="Predictecd vs Residuals")

# check normality
hist(resid.model.anth, main="Histogram of Residuals", xlab="Rye stem diameter")

qqnorm(resid.model.anth) 

# Shapiro-Wilk test
shapiro.test(resid.model.anth)

anthemmeans1<- emmeans(model.anth.best, pairwise ~ Cult*Location)
anthemmeans1
plot(anthemmeans1, comparisons=T)
```


### Corn VT stage
```{r corn VT stage}
datw$VT_date
```


### Corn stand

```{r corn stand}
datw$Corn_stand

# plot of corn stand by cultivar & seeding rate, separated by location & year
standplot1<- ggplot(datw, aes(x = Trt_code, y = Corn_stand, fill=factor(SR))) +
          geom_boxplot() +
          facet_wrap(Location~Year)+
          theme_bw()
print(standplot1)
```

``` {r corn stand analysis -- trt vs ctrl}
# model analysis for corn stand 

# test effect of rye
model.stand<- lmer(Corn_stand ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datw)
summary(model.stand)
anova(model.stand)

model.stand.best<- get_model(lmerTest::step(model.stand, reduce.random=F))
summary(model.stand.best)
anova(model.stand.best)

# check residuals
resid.model.stand<- resid(model.stand.best)
pred.model.stand<- predict(model.stand.best)

# check randomness
plot(pred.model.stand, resid.model.stand, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.stand, main="Histogram of Residuals", xlab="Corn stand")
# long tails on left

qqnorm(resid.model.stand) # messy on ends

# Shapiro-Wilk test
shapiro.test(resid.model.stand)
# data assumptions not great... try transformations

standemmeans<- emmeans(model.stand.best, pairwise ~ Trt_code)
standemmeans
plot(standemmeans, comparisons=T)
# some trts higher than W1N
```
*Best Model:*
Corn_stand ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
         Sum Sq Mean Sq NumDF  DenDF F value  Pr(>F)  
Trt_code 709.11   101.3     7 222.27  2.5881 0.01386 *

*Assumptions:*
slightly left skewed

*Means:*
 Trt_code emmean   SE   df lower.CL upper.CL
 E1W1N      31.8 2.91 4.31     24.0     39.7
 E2W1N      30.9 2.91 4.31     23.0     38.8
 E3W1N      30.9 2.91 4.31     23.0     38.7
 S1W1N      29.9 2.88 4.13     22.0     37.8
 S2W1N      30.5 2.88 4.13     22.6     38.4
 S3W1N      32.9 2.88 4.13     25.0     40.9
 W1N        26.8 2.88 4.13     18.9     34.7
 WF1N       29.7 2.88 4.13     21.8     37.6

*Contrasts:*
 contrast      estimate   SE  df t.ratio p.value
 E1W1N - E2W1N   0.9286 1.67 218  0.555  0.9993 
 E1W1N - E3W1N   0.9643 1.67 218  0.577  0.9991 
 E1W1N - S1W1N   1.9444 1.62 218  1.198  0.9320 
 E1W1N - S2W1N   1.3507 1.62 218  0.832  0.9911 
 E1W1N - S3W1N  -1.1181 1.62 218 -0.689  0.9972 
 E1W1N - W1N     5.0069 1.62 218  3.084  0.0468 *
 E1W1N - WF1N    2.1007 1.62 218  1.294  0.9004 
 E2W1N - E3W1N   0.0357 1.67 218  0.021  1.0000 
 E2W1N - S1W1N   1.0159 1.62 218  0.626  0.9985 
 E2W1N - S2W1N   0.4221 1.62 218  0.260  1.0000 
 E2W1N - S3W1N  -2.0466 1.62 218 -1.261  0.9122 
 E2W1N - W1N     4.0784 1.62 218  2.512  0.1960 
 E2W1N - WF1N    1.1721 1.62 218  0.722  0.9963 
 E3W1N - S1W1N   0.9802 1.62 218  0.604  0.9988 
 E3W1N - S2W1N   0.3864 1.62 218  0.238  1.0000 
 E3W1N - S3W1N  -2.0823 1.62 218 -1.283  0.9045 
 E3W1N - W1N     4.0427 1.62 218  2.490  0.2053 
 E3W1N - WF1N    1.1364 1.62 218  0.700  0.9969 
 S1W1N - S2W1N  -0.5938 1.56 218 -0.380  0.9999 
 S1W1N - S3W1N  -3.0625 1.56 218 -1.958  0.5127 
 S1W1N - W1N     3.0625 1.56 218  1.958  0.5127 
 S1W1N - WF1N    0.1562 1.56 218  0.100  1.0000 
 S2W1N - S3W1N  -2.4688 1.56 218 -1.578  0.7627 
 S2W1N - W1N     3.6562 1.56 218  2.338  0.2782 
 S2W1N - WF1N    0.7500 1.56 218  0.480  0.9997 
 S3W1N - W1N     6.1250 1.56 218  3.916  0.0030 *
 S3W1N - WF1N    3.2188 1.56 218  2.058  0.4456 
 W1N - WF1N     -2.9062 1.56 218 -1.858  0.5811


```{r corn stand analysis -- trts}
# test effect of trts
model.standtrt<- lmer(Corn_stand ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.standtrt)
anova(model.standtrt)

model.standtrt.best<- get_model(lmerTest::step(model.standtrt, reduce.random=F))
summary(model.standtrt.best)
anova(model.standtrt.best)

# check residuals
resid.model.standtrt<- resid(model.standtrt.best)
pred.model.standtrt<- predict(model.standtrt.best)

# check randomness
plot(pred.model.standtrt, resid.model.standtrt, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.standtrt, main="Histogram of Residuals", xlab="Corn stand")
# long tails on left

qqnorm(resid.model.standtrt) # messy on ends

# Shapiro-Wilk test
shapiro.test(resid.model.standtrt)
# data assumptions not great... try transformations


# transformations (none really helped)
model.standtrt2<- lmer((Corn_stand)^1/3 ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.standtrt2)
anova(model.standtrt2)

model.standtrt.best2<- get_model(lmerTest::step(model.standtrt2, reduce.random=F))
summary(model.standtrt.best2)
Anova(model.standtrt.best2, type="III")

# check residuals
resid.model.standtrt2<- resid(model.standtrt.best2)
pred.model.standtrt2<- predict(model.standtrt.best2)

# check randomness
plot(pred.model.standtrt2, resid.model.standtrt2, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.standtrt2, main="Histogram of Residuals", xlab="Corn stand")
# long tails on left

qqnorm(resid.model.standtrt2) # messy on ends

# Shapiro-Wilk test
shapiro.test(resid.model.standtrt2)

```
*Best Model:*
Corn_stand ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
slightly left skewed -- cubed slightly helped but not really

*Means:*
None


```{r corn stand analysis -- w vs wf trts, E & S all SR}
# test effect of w/wf trt -> Harrow E & S, all SR
model.standw<- lmer(Corn_stand ~ Weediness * Cult * SR + (1 | Year / Rep), data=Hdatw)
summary(model.standw)
anova(model.standw)

model.standw.best<- get_model(lmerTest::step(model.standw, reduce.random=F))
summary(model.standw.best)
anova(model.standw.best)

# check residuals
resid.model.standw<- resid(model.standw.best)
pred.model.standw<- predict(model.standw.best)

# check randomness
plot(pred.model.standw, resid.model.standw, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.standw, main="Histogram of Residuals", xlab="Corn stand")

qqnorm(resid.model.standw) # messy on ends

# Shapiro-Wilk test
shapiro.test(resid.model.standw)

# no main effects to compare means

# no effect of weediness
```
*Best Model:*
Corn_stand ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Good

*Means:*
None


```{r corn stand analysis -- w vs wf trts, E & S 600}
# test effect of w/wf trt -> Harrow & StJean E & S, 600
model.standw600<- lmer(Corn_stand ~ Weediness * Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datw1)
summary(model.standw600)
anova(model.standw600)

model.standw600.best<- get_model(lmerTest::step(model.standw600, reduce.random=F))
summary(model.standw600.best)
anova(model.standw600.best)

# check residuals
resid.model.standw600<- resid(model.standw600.best)
pred.model.standw600<- predict(model.standw600.best)

# check randomness
plot(pred.model.standw600, resid.model.standw600, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals") # very separated

# check normality
hist(resid.model.standw600, main="Histogram of Residuals", xlab="Corn stand")

qqnorm(resid.model.standw600)

# Shapiro-Wilk test
shapiro.test(resid.model.standw600)

# means

# no weediness effect
```
*Best Model:*
Corn_stand ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not great -- not a lot of data

*Means:*
None


```{r corn stand analysis -- w vs wf trts, S 600}
# test effect of w/wf trt ->  S, 600
model.standws<- lmer(Corn_stand ~ Weediness + (1 | Year / Rep) + (1 | Location / Rep), data=datw2)
summary(model.standws)
anova(model.standws)

model.standws.best<- get_model(lmerTest::step(model.standws, reduce.random=F))
summary(model.standws.best)
anova(model.standws.best)

# check residuals
resid.model.standws<- resid(model.standws.best)
pred.model.standws<- predict(model.standws.best)

# check randomness
plot(pred.model.standws, resid.model.standws, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.standws, main="Histogram of Residuals", xlab="Corn stand")

qqnorm(resid.model.standws)

# Shapiro-Wilk test
shapiro.test(resid.model.standws)

# no main effects to compare means

# no effect of weediness
```
*Best Model:*
Corn_stand ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not great -- not a lot of data

*Means:*
None


```{r corn stand analysis -- wf trt vs ctrl, E & S all SR}
# test effect of trts
model.standwf<- lmer(Corn_stand ~ Trt_code + (1 | Year / Rep), data=Hdatwf)
summary(model.standwf)
anova(model.standwf)

model.standwf.best<- get_model(lmerTest::step(model.standwf, reduce.random=F))
summary(model.standwf.best)
anova(model.standwf.best)

# check residuals
resid.model.standwf<- resid(model.standwf.best)
pred.model.standwf<- predict(model.standwf.best)

# check randomness
plot(pred.model.standwf, resid.model.standwf, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.standwf, main="Histogram of Residuals", xlab="Corn stand")

qqnorm(resid.model.standwf) 

# Shapiro-Wilk test
shapiro.test(resid.model.standwf)

# no main effects -> WF no rye not diff than trts
```
*Best Model:*
Corn_stand ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Fine

*Means:*
None


```{r corn stand analysis -- wf trt vs ctrl, E & S 600}
# test effect of trts
model.standwf600<- lmer(Corn_stand ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf1)
summary(model.standwf600)
anova(model.standwf600)

model.standwf600.best<- get_model(lmerTest::step(model.standwf600, reduce.random=F))
summary(model.standwf600.best)
anova(model.standwf600.best)

# check residuals
resid.model.standwf600<- resid(model.standwf600.best)
pred.model.standwf600<- predict(model.standwf600.best)

# check randomness
plot(pred.model.standwf600, resid.model.standwf600, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.standwf600, main="Histogram of Residuals", xlab="Corn stand")

qqnorm(resid.model.standwf600) 

# Shapiro-Wilk test
shapiro.test(resid.model.standwf600)

# means
standwf600emmeans<- emmeans(model.standwf600.best, pairwise ~ Trt_code)
standwf600emmeans
plot(standwf600emmeans, comparisons=T) # [Harrow E = Harrow S = Harrow NR] > [StJean E = StJean S] > StJean NR, (Harrow NR = StJean E)
```
*Best Model:*
Corn_stand ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
         Sum Sq Mean Sq NumDF  DenDF F value   Pr(>F)   
Trt_code 297.06  148.53     2 31.171   7.597 0.002053 **

*Assumptions:*
Not great -- hist square-like

*Means:*
 Trt_code emmean   SE   df lower.CL upper.CL
 E3WF1N     31.0 6.48 1.11    -34.7     96.8
 S3WF1N     30.1 6.48 1.11    -35.6     95.9
 WF1N       24.5 6.48 1.11    -41.2     90.3

*Contrasts:*
 contrast        estimate   SE   df t.ratio p.value
 E3WF1N - S3WF1N    0.917 1.81 24.2 0.508   0.8683 
 E3WF1N - WF1N      6.500 1.81 24.2 3.601   0.0039 *
 S3WF1N - WF1N      5.583 1.81 24.2 3.093   0.0132 *


```{r corn stand analysis -- wf trts vs ctrl, S 600}
# test effect of trts
model.standwfs<- lmer(Corn_stand ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf2)
summary(model.standwfs)
anova(model.standwfs)

model.standwfs.best<- get_model(lmerTest::step(model.standwfs, reduce.random=F))
summary(model.standwfs.best)
anova(model.standwfs.best)

# check residuals
resid.model.standwfs<- resid(model.standwfs.best)
pred.model.standwfs<- predict(model.standwfs.best)

# check randomness
plot(pred.model.standwfs, resid.model.standwfs, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.standwfs, main="Histogram of Residuals", xlab="Corn stand")

qqnorm(resid.model.standwfs) 

# Shapiro-Wilk test
shapiro.test(resid.model.standwfs)

# means
```
*Best Model:*
Corn_stand ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not great -- not a lot of data

*Means:*
None
 
 
```{r corn stand analysis -- wf trts, E & S all SR}
# test effect within trts
model.standwftrt<- lmer(Corn_stand ~ Cult * SR + (1 | Year / Rep), data=Hdatwftrt)
summary(model.standwftrt)
anova(model.standwftrt)

model.standwftrt.best<- get_model(lmerTest::step(model.standwftrt, reduce.random=F))
summary(model.standwftrt.best)
anova(model.standwftrt.best)

# check residuals
resid.model.standwftrt<- resid(model.standwftrt.best)
pred.model.standwftrt<- predict(model.standwftrt.best)

# check randomness
plot(pred.model.standwftrt, resid.model.standwftrt, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.standwftrt, main="Histogram of Residuals", xlab="Corn stand")

qqnorm(resid.model.standwftrt) 

# Shapiro-Wilk test
shapiro.test(resid.model.standwftrt)

# no main effects
```
*Best Model:*
Corn_stand ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Good

*Means:*
None


```{r corn stand analysis -- wf trts, E & S 600}
# test effect within trts
model.standwftrt600<- lmer(Corn_stand ~ Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datwftrt1)
summary(model.standwftrt600)
anova(model.standwftrt600)

model.standwftrt600.best<- get_model(lmerTest::step(model.standwftrt600, reduce.random=F))
summary(model.standwftrt600.best)
anova(model.standwftrt600.best)

# check residuals
resid.model.standwftrt600<- resid(model.standwftrt600.best)
pred.model.standwftrt600<- predict(model.standwftrt600.best)

# check randomness
plot(pred.model.standwftrt600, resid.model.standwftrt600, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.standwftrt600, main="Histogram of Residuals", xlab="Corn stand")

qqnorm(resid.model.standwftrt600) 

# Shapiro-Wilk test
shapiro.test(resid.model.standwftrt600)

# means
```
*Best Model:*
Corn_stand ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not great -- not a lot of data

*Means:*
None



### Corn height

```{r corn ht}
datw$Corn_ht_av

# plot of average corn height by cultivar & seeding rate, separated by location & year
htplot1<- ggplot(datw, aes(x = Trt_code, y = Corn_ht_av, fill=factor(SR))) +
          geom_boxplot() +
          facet_wrap(Location~Year)+
          theme_bw()
print(htplot1)
```

```{r corn ht analysis -- trt vs ctrl}
# test effect of trts vs ctrls
model.ht<- lmer(Corn_ht_av ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datw)
summary(model.ht)
anova(model.ht)

model.ht.best<- get_model(lmerTest::step(model.ht, reduce.random=F))
summary(model.ht.best)
anova(model.ht.best)

# check residuals
resid.model.ht<- resid(model.ht.best)
pred.model.ht<- predict(model.ht.best)

# check randomness
plot(pred.model.ht, resid.model.ht, ylab="Residuals", xlab="Average corn height", main="Predictecd vs Residuals")

# check normality
hist(resid.model.ht, main="Histogram of Residuals", xlab="Average corn height")

qqnorm(resid.model.ht) # 

# Shapiro-Wilk test
shapiro.test(resid.model.ht)

htemmeans<- emmeans(model.ht.best, pairwise ~ Trt_code)
htemmeans
plot(htemmeans, comparisons=T) # ctrls > trts
```
*Best Model:*
Corn_ht_av ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
         Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    
Trt_code 4101.5  585.92     7 222.97  8.3227 5.037e-09 ***

*Assumptions:*
Good

*Means:*
 Trt_code emmean   SE   df lower.CL upper.CL
 E1W1N      46.1 9.85 3.61     17.6     74.7
 E2W1N      45.7 9.85 3.61     17.1     74.2
 E3W1N      45.6 9.85 3.61     17.0     74.1
 S1W1N      45.9 9.84 3.59     17.3     74.5
 S2W1N      46.5 9.84 3.59     17.9     75.1
 S3W1N      47.8 9.84 3.59     19.2     76.4
 W1N        55.1 9.84 3.60     26.5     83.7
 WF1N       56.0 9.84 3.59     27.5     84.6

*Contrasts:*
 contrast      estimate   SE  df t.ratio p.value
 E1W1N - E2W1N    0.439 2.24 218  0.196  1.0000 
 E1W1N - E3W1N    0.543 2.24 218  0.242  1.0000 
 E1W1N - S1W1N    0.222 2.18 218  0.102  1.0000 
 E1W1N - S2W1N   -0.362 2.18 218 -0.166  1.0000 
 E1W1N - S3W1N   -1.653 2.18 218 -0.759  0.9949 
 E1W1N - W1N     -8.953 2.20 218 -4.076  0.0016 * 
 E1W1N - WF1N    -9.909 2.18 218 -4.551  0.0002 
 E2W1N - E3W1N    0.104 2.24 218  0.046  1.0000 
 E2W1N - S1W1N   -0.217 2.18 218 -0.100  1.0000 
 E2W1N - S2W1N   -0.801 2.18 218 -0.368  1.0000 
 E2W1N - S3W1N   -2.092 2.18 218 -0.961  0.9793 
 E2W1N - W1N     -9.392 2.20 218 -4.277  0.0007 *
 E2W1N - WF1N   -10.348 2.18 218 -4.753  0.0001 *
 E3W1N - S1W1N   -0.321 2.18 218 -0.147  1.0000 
 E3W1N - S2W1N   -0.905 2.18 218 -0.416  0.9999 
 E3W1N - S3W1N   -2.196 2.18 218 -1.008  0.9728 
 E3W1N - W1N     -9.496 2.20 218 -4.324  0.0006 *
 E3W1N - WF1N   -10.452 2.18 218 -4.800  0.0001 *
 S1W1N - S2W1N   -0.584 2.10 218 -0.279  1.0000 
 S1W1N - S3W1N   -1.875 2.10 218 -0.894  0.9864 
 S1W1N - W1N     -9.175 2.12 218 -4.337  0.0006 *
 S1W1N - WF1N   -10.131 2.10 218 -4.830  0.0001 *
 S2W1N - S3W1N   -1.291 2.10 218 -0.615  0.9986 
 S2W1N - W1N     -8.591 2.12 218 -4.061  0.0017 *
 S2W1N - WF1N    -9.547 2.10 218 -4.551  0.0002 *
 S3W1N - W1N     -7.300 2.12 218 -3.451  0.0152 *
 S3W1N - WF1N    -8.256 2.10 218 -3.936  0.0028 *
 W1N - WF1N      -0.956 2.12 218 -0.452  0.9998 


```{r corn ht analysis -- trts}
# trt effect
model.ht.trt<- lmer(Corn_ht_av ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.ht.trt)
anova(model.ht.trt)

model.ht.trt.best<- get_model(lmerTest::step(model.ht.trt, reduce.random=F))
summary(model.ht.trt.best)
anova(model.ht.trt.best)

# check residuals
resid.model.httrt<- resid(model.ht.trt.best)
pred.model.httrt<- predict(model.ht.trt.best)

# check randomness
plot(pred.model.httrt, resid.model.httrt, ylab="Residuals", xlab="Average corn height", main="Predictecd vs Residuals")

# check normality
hist(resid.model.httrt, main="Histogram of Residuals", xlab="Average corn height")

qqnorm(resid.model.httrt) # messy on ends

# Shapiro-Wilk test
shapiro.test(resid.model.httrt)

# means
```
*Best Model:*
Corn_ht_av ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Good

*Means:*
None


```{r corn ht analysis -- w vs wf trts, E & S all SR}
# test effect of w/wf trt -> Harrow E & S, all SR
model.htw<- lmer(Corn_ht_av ~ Weediness * Cult * SR + (1 | Year / Rep), data=Hdatw)
summary(model.htw)
anova(model.htw)

model.htw.best<- get_model(lmerTest::step(model.htw, reduce.random=F))
summary(model.htw.best)
anova(model.htw.best)

# check residuals
resid.model.htw<- resid(model.htw.best)
pred.model.htw<- predict(model.htw.best)

# check randomness
plot(pred.model.htw, resid.model.htw, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.htw, main="Histogram of Residuals", xlab="Corn stand")

qqnorm(resid.model.htw)

# Shapiro-Wilk test
shapiro.test(resid.model.htw)

# means
htwemmeans<- emmeans(model.htw.best, pairwise ~ Weediness)
htwemmeans
plot(htwemmeans, comparisons=T)

# W > WF
```
*Best Model:*
Corn_ht_av ~ Weediness + (1 | Year/Rep)

*Effects:*
          Sum Sq Mean Sq NumDF DenDF F value   Pr(>F)   
Weediness 102.09  102.09     1    87  8.4947 0.004528 **

*Assumptions:*
Fine

*Means:*
 Weediness emmean   SE   df lower.CL upper.CL
 W           61.8 5.92 1.01    -12.2      136
 WF          59.7 5.92 1.01    -14.3      134

*Contrasts:*
 contrast estimate    SE df t.ratio p.value
 W - WF       2.06 0.708 87 2.915   0.0045 *


```{r corn ht analysis -- w vs wf trts, E & S 600}
# test effect of w/wf trt -> Harrow & StJean E & S, 600
model.htw600<- lmer(Corn_ht_av ~ Weediness * Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datw1)
summary(model.htw600)
anova(model.htw600)

model.htw600.best<- get_model(lmerTest::step(model.htw600, reduce.random=F))
summary(model.htw600.best)
anova(model.htw600.best)

# check residuals
resid.model.htw600<- resid(model.htw600.best)
pred.model.htw600<- predict(model.htw600.best)

# check randomness
plot(pred.model.htw600, resid.model.htw600, ylab="Residuals", xlab="Corn ht", main="Predictecd vs Residuals") 

# check normality
hist(resid.model.htw600, main="Histogram of Residuals", xlab="Corn ht")

qqnorm(resid.model.htw600)

# Shapiro-Wilk test
shapiro.test(resid.model.htw600)

# means
htw600emmeans<- emmeans(model.htw600.best, pairwise ~ Cult)
htw600emmeans
plot(htw600emmeans, comparisons=T)

# no weediness effect
```
*Best Model:*
Corn_ht_av ~ Cult + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
     Sum Sq Mean Sq NumDF  DenDF F value  Pr(>F)  
Cult 96.617  96.617     1 39.389  5.4598 0.02464 *

*Assumptions:*
Not great -- hist not bell curve

*Means:*
 Cult     emmean   SE   df lower.CL upper.CL
 Early      42.2 17.3 1.25    -96.6      181
 Standard   45.0 17.3 1.25    -93.7      184

*Contrasts:*
 contrast         estimate   SE   df t.ratio p.value
 Early - Standard    -2.84 1.21 36.5 -2.337  0.0251 *


```{r corn ht analysis -- w vs wf trts, S 600}
# test effect of w/wf trt -> S, 600
model.htws<- lmer(Corn_ht_av ~ Weediness + (1 | Year / Rep) + (1 | Location / Rep), data=datw2)
summary(model.htws)
anova(model.htws)

model.htws.best<- get_model(lmerTest::step(model.htws, reduce.random=F))
summary(model.htws.best)
anova(model.htws.best)

# check residuals
resid.model.htws<- resid(model.htws.best)
pred.model.htws<- predict(model.htws.best)

# check randomness
plot(pred.model.htws, resid.model.htws, ylab="Residuals", xlab="Corn ht", main="Predictecd vs Residuals")

# check normality
hist(resid.model.htws, main="Histogram of Residuals", xlab="Corn ht")

qqnorm(resid.model.htws)

# Shapiro-Wilk test
shapiro.test(resid.model.htws)

# no main effects to compare means

# no effect of weediness
```
*Best Model:*
Corn_ht_av ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not great -- not a lot of data

*Means:*
None


```{r corn ht analysis -- wf trt vs ctrl, E & S all SR}
# test effect of trts
model.htwf<- lmer(Corn_ht_av ~ Trt_code + (1 | Year / Rep), data=Hdatwf)
summary(model.htwf)
anova(model.htwf)

model.htwf.best<- get_model(lmerTest::step(model.htwf, reduce.random=F))
summary(model.htwf.best)
anova(model.htwf.best)

# check residuals
resid.model.htwf<- resid(model.htwf.best)
pred.model.htwf<- predict(model.htwf.best)

# check randomness
plot(pred.model.htwf, resid.model.htwf, ylab="Residuals", xlab="Corn ht", main="Predictecd vs Residuals")

# check normality
hist(resid.model.htwf, main="Histogram of Residuals", xlab="Corn ht")

qqnorm(resid.model.htwf) 

# Shapiro-Wilk test
shapiro.test(resid.model.htwf)

# no main effects -> WF no rye not diff than trts
```
*Best Model:*
Corn_ht_av ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Fine

*Means:*
None


```{r corn ht analysis -- wf trt vs ctrl, E & S 600}
# test effect of trts
model.htwf600<- lmer(Corn_ht_av ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf1)
summary(model.htwf600)
anova(model.htwf600)

model.htwf600.best<- get_model(lmerTest::step(model.htwf600, reduce.random=F))
summary(model.htwf600.best)
anova(model.htwf600.best)

# check residuals
resid.model.htwf600<- resid(model.htwf600.best)
pred.model.htwf600<- predict(model.htwf600.best)

# check randomness
plot(pred.model.htwf600, resid.model.htwf600, ylab="Residuals", xlab="Corn ht", main="Predictecd vs Residuals")

# check normality
hist(resid.model.htwf600, main="Histogram of Residuals", xlab="Corn ht")

qqnorm(resid.model.htwf600) 

# Shapiro-Wilk test
shapiro.test(resid.model.htwf600)

# means
htwf600emmeans<- emmeans(model.htwf600.best, pairwise ~ Trt_code)
htwf600emmeans
plot(htwf600emmeans, comparisons=T) # 
```
*Best Model:*
Corn_ht_av ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
         Sum Sq Mean Sq NumDF DenDF F value    Pr(>F)    
Trt_code   2175  1087.5     2 30.72  13.491 6.235e-05 ***

*Assumptions:*
Fine

*Means:*
 Trt_code emmean SE   df lower.CL upper.CL
 E3WF1N     44.0 10 1.23    -39.2      127
 S3WF1N     48.3 10 1.23    -34.8      132
 WF1N       62.2 10 1.23    -21.0      145
 
*Contrasts:*
 contrast        estimate   SE   df t.ratio p.value
 E3WF1N - S3WF1N    -4.34 3.67 24.3 -1.185  0.4734 
 E3WF1N - WF1N     -18.23 3.67 24.3 -4.972  0.0001 *
 S3WF1N - WF1N     -13.88 3.67 24.3 -3.788  0.0025 *


```{r corn ht analysis -- wf trt vs ctrl, S 600}
# test effect of trts
model.htwfs<- lmer(Corn_ht_av ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf2)
summary(model.htwfs)
anova(model.htwfs)

model.htwfs.best<- get_model(lmerTest::step(model.htwfs, reduce.random=F))
summary(model.htwfs.best)
anova(model.htwfs.best)

# check residuals
resid.model.htwfs<- resid(model.htwfs.best)
pred.model.htwfs<- predict(model.htwfs.best)

# check randomness
plot(pred.model.htwfs, resid.model.htwfs, ylab="Residuals", xlab="Corn ht", main="Predictecd vs Residuals")

# check normality
hist(resid.model.htwfs, main="Histogram of Residuals", xlab="Corn ht")

qqnorm(resid.model.htwfs) 

# Shapiro-Wilk test
shapiro.test(resid.model.htwfs)

# means
```
*Best Model:*
Corn_ht_av ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Fine -- not a lot of data

*Means:*
None
 
 
```{r corn ht analysis -- wf trts, E & S all SR}
# test effect of trts
model.htwftrt<- lmer(Corn_ht_av ~ Cult * SR + (1 | Year / Rep), data=Hdatwftrt)
summary(model.htwftrt)
anova(model.htwftrt)

model.htwftrt.best<- get_model(lmerTest::step(model.htwftrt, reduce.random=F))
summary(model.htwftrt.best)
anova(model.htwftrt.best)

# check residuals
resid.model.htwftrt<- resid(model.htwftrt.best)
pred.model.htwftrt<- predict(model.htwftrt.best)

# check randomness
plot(pred.model.htwftrt, resid.model.htwftrt, ylab="Residuals", xlab="Corn ht", main="Predictecd vs Residuals")

# check normality
hist(resid.model.htwftrt, main="Histogram of Residuals", xlab="Corn ht")

qqnorm(resid.model.htwftrt) 

# Shapiro-Wilk test
shapiro.test(resid.model.htwftrt)

# no main effects
```
*Best Model:*
Corn_ht_av ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Fine -- slightly left skewed

*Means:*
None


```{r corn ht analysis -- wf trts, E & S 600}
# test effect of trts
model.htwftrt600<- lmer(Corn_ht_av ~ Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datwftrt1)
summary(model.htwftrt600)
anova(model.htwftrt600)

model.htwftrt600.best<- get_model(lmerTest::step(model.htwftrt600, reduce.random=F))
summary(model.htwftrt600.best)
anova(model.htwftrt600.best)

# check residuals
resid.model.htwftrt600<- resid(model.htwftrt600.best)
pred.model.htwftrt600<- predict(model.htwftrt600.best)

# check randomness
plot(pred.model.htwftrt600, resid.model.htwftrt600, ylab="Residuals", xlab="Corn ht", main="Predictecd vs Residuals")

# check normality
hist(resid.model.htwftrt600, main="Histogram of Residuals", xlab="Corn ht")

qqnorm(resid.model.htwftrt600) 

# Shapiro-Wilk test
shapiro.test(resid.model.htwftrt600)

# means
htwftrt600emmeans<- emmeans(model.htwftrt600.best, pairwise ~ Cult)
htwftrt600emmeans
plot(htwftrt600emmeans, comparisons=T) # Harrow S = Harrow E > S StJean > E StJean
```
*Best Model:*
Corn_ht_av ~ Cult + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
     Sum Sq Mean Sq NumDF  DenDF F value  Pr(>F)  
Cult  113.1   113.1     1 10.704  8.7856 0.01324 *

*Assumptions:*
Not great -- hist square-like

*Means:*
 Cult     emmean   SE   df lower.CL upper.CL
 Early      41.3 15.7 1.15     -105      188
 Standard   45.6 15.7 1.15     -101      192
 
*Contrasts:*
 contrast         estimate   SE   df t.ratio p.value
 Early - Standard    -4.34 1.46 11.9 -2.964  0.0120 *



### Marketable corn count

```{r M corn count}
datw$M_count

# plot of marketable cob count by cultivar & seeding rate, separated by location & year
Mplot1<- ggplot(datw, aes(x = Trt_code, y = M_count, fill=factor(SR))) +
          geom_boxplot() +
          facet_wrap(Location~Year)+
          theme_bw()
print(Mplot1)
```

```{r M corn count analysis -- trt vs ctrl}
# model analysis for marketable corn count trts vs ctrls
model.M<- lmer(M_count ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datw)
summary(model.M)
anova(model.M)

model.M.best<- get_model(lmerTest::step(model.M, reduce.random=F))
summary(model.M.best)
anova(model.M.best)

# check residuals
resid.model.M<- resid(model.M.best)
pred.model.M<- predict(model.M.best)

# check randomness
plot(pred.model.M, resid.model.M, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals")
# large separation

# check normality
hist(resid.model.M, main="Histogram of Residuals", xlab="Marketable cob count")
# outlier? -> WF?

qqnorm(resid.model.M) # messy on ends

# Shapiro-Wilk test
shapiro.test(resid.model.M)

# means
Mcountemmeans<- emmeans(model.M.best, pairwise ~ Trt_code)
Mcountemmeans
plot(Mcountemmeans, comparisons=T) # WF > trts & W (W slightly lower than trts, not signif)
```
*Best Model:*
M_count ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
         Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    
Trt_code 6034.7   862.1     7 159.79  13.264 1.994e-13 ***

*Assumptions:*
Fine -- possible outlier but important data point

*Means:*
 Trt_code emmean   SE   df lower.CL upper.CL
 E1W1N      6.59 5.37 4.30    -7.93     21.1
 E2W1N      9.16 5.37 4.30    -5.36     23.7
 E3W1N      7.91 5.37 4.30    -6.61     22.4
 S1W1N      7.54 5.31 4.12    -7.05     22.1
 S2W1N      8.14 5.31 4.12    -6.45     22.7
 S3W1N      9.63 5.31 4.12    -4.96     24.2
 W1N        3.83 5.31 4.12   -10.75     18.4
 WF1N      23.82 5.31 4.12     9.24     38.4

*Contrasts:*
 contrast      estimate   SE  df t.ratio p.value
 E1W1N - E2W1N   -2.570 2.55 156 -1.008  0.9727 
 E1W1N - E3W1N   -1.320 2.55 156 -0.518  0.9996 
 E1W1N - S1W1N   -0.945 2.45 156 -0.385  0.9999 
 E1W1N - S2W1N   -1.545 2.45 156 -0.629  0.9984 
 E1W1N - S3W1N   -3.036 2.45 156 -1.237  0.9196 
 E1W1N - W1N      2.759 2.45 156  1.124  0.9506 
 E1W1N - WF1N   -17.228 2.45 156 -7.018  <.0001 *
 E2W1N - E3W1N    1.250 2.55 156  0.490  0.9997 
 E2W1N - S1W1N    1.625 2.45 156  0.662  0.9978 
 E2W1N - S2W1N    1.025 2.45 156  0.418  0.9999 
 E2W1N - S3W1N   -0.466 2.45 156 -0.190  1.0000 
 E2W1N - W1N      5.329 2.45 156  2.171  0.3750 
 E2W1N - WF1N   -14.658 2.45 156 -5.971  <.0001 *
 E3W1N - S1W1N    0.375 2.45 156  0.153  1.0000 
 E3W1N - S2W1N   -0.225 2.45 156 -0.092  1.0000 
 E3W1N - S3W1N   -1.716 2.45 156 -0.699  0.9969 
 E3W1N - W1N      4.079 2.45 156  1.662  0.7116 
 E3W1N - WF1N   -15.908 2.45 156 -6.481  <.0001 *
 S1W1N - S2W1N   -0.600 2.33 156 -0.258  1.0000 
 S1W1N - S3W1N   -2.092 2.33 156 -0.899  0.9858 
 S1W1N - W1N      3.704 2.33 156  1.592  0.7547 
 S1W1N - WF1N   -16.283 2.33 156 -6.997  <.0001 *
 S2W1N - S3W1N   -1.492 2.33 156 -0.641  0.9982 
 S2W1N - W1N      4.304 2.33 156  1.849  0.5875 
 S2W1N - WF1N   -15.683 2.33 156 -6.739  <.0001 *
 S3W1N - W1N      5.796 2.33 156  2.490  0.2073 
 S3W1N - WF1N   -14.192 2.33 156 -6.098  <.0001 *
 W1N - WF1N     -19.988 2.33 156 -8.588  <.0001 *


```{r M corn count analysis -- trts}
# model analysis for marketable corn count trts
model.M.trt<- lmer(M_count ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.M.trt)
anova(model.M.trt)

model.M.trt.best<- get_model(lmerTest::step(model.M.trt, reduce.random=F))
summary(model.M.trt.best)
anova(model.M.trt.best)

# check residuals
resid.model.Mtrt<- resid(model.M.trt.best)
pred.model.Mtrt<- predict(model.M.trt.best)

# check randomness
plot(pred.model.Mtrt, resid.model.Mtrt, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mtrt, main="Histogram of Residuals", xlab="Marketable cob count")

qqnorm(resid.model.Mtrt) # messy on ends

# Shapiro-Wilk test
shapiro.test(resid.model.Mtrt)
# not great -> few high values

# means
```
*Best Model:*
M_count ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Right skewed

*Means:*
None


```{r M corn count analysis -- w vs wf trts, E & S all SR}
# test effect of w/wf trt -> Harrow E & S, all SR
model.Mw<- lmer(M_count ~ Weediness * Cult * SR + (1 | Year / Rep), data=Hdatw)
summary(model.Mw)
anova(model.Mw)

model.Mw.best<- get_model(lmerTest::step(model.Mw, reduce.random=F))
summary(model.Mw.best)
anova(model.Mw.best)

# check residuals
resid.model.Mw<- resid(model.Mw.best)
pred.model.Mw<- predict(model.Mw.best)

# check randomness
plot(pred.model.Mw, resid.model.Mw, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mw, main="Histogram of Residuals", xlab="Marketable cob count")

qqnorm(resid.model.Mw)

# Shapiro-Wilk test
shapiro.test(resid.model.Mw)

# means
Mwemmeans<- emmeans(model.Mw.best, pairwise ~ Weediness)
Mwemmeans
plot(Mwemmeans, comparisons=T)

# WF > W
```
*Best Model:*
M_count ~ Weediness + (1 | Year/Rep)

*Effects:*
          Sum Sq Mean Sq NumDF DenDF F value    Pr(>F)    
Weediness 5460.2  5460.2     1    93  83.481 1.371e-14 ***

*Assumptions:*
Mostly mid-level data

*Means:*
 Weediness emmean   SE   df lower.CL upper.CL
 W             16 8.81 1.02    -91.5      123
 WF            31 8.81 1.02    -76.4      138
 
 *Contrasts:*
  contrast estimate   SE df t.ratio p.value
 W - WF      -15.1 1.65 87 -9.137  <.0001 *


```{r Mcorn count analysis -- w vs wf trts, E & S 600}
# test effect of w/wf trt -> Harrow & StJean E & S, 600
model.Mw600<- lmer(M_count ~ Weediness * Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datw1)
summary(model.Mw600)
anova(model.Mw600)

model.Mw600.best<- get_model(lmerTest::step(model.Mw600, reduce.random=F))
summary(model.Mw600.best)
anova(model.Mw600.best)

# check residuals
resid.model.Mw600<- resid(model.Mw600.best)
pred.model.Mw600<- predict(model.Mw600.best)

# check randomness
plot(pred.model.Mw600, resid.model.Mw600, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals") 

# check normality
hist(resid.model.Mw600, main="Histogram of Residuals", xlab="Marketable cob count")

qqnorm(resid.model.Mw600)

# Shapiro-Wilk test
shapiro.test(resid.model.Mw600)

# means
Mw600emmeans<- emmeans(model.Mw600.best, pairwise ~ Weediness)
Mw600emmeans
plot(Mw600emmeans, comparisons=T) #
```
*Best Model:*
M_count ~ Weediness + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
          Sum Sq Mean Sq NumDF  DenDF F value   Pr(>F)    
Weediness 1510.9  1510.9     1 43.935  20.193 5.04e-05 ***

*Assumptions:*
Not bad

*Means:*
 Weediness emmean   SE   df lower.CL upper.CL
 W           10.2 12.2 1.98    -43.0     63.3
 WF          21.4 12.2 1.98    -31.7     74.6
 
 *Contrasts:*
 contrast estimate  SE   df t.ratio p.value
 W - WF      -11.2 2.5 37.2 -4.494  0.0001 *
 
 
```{r M corn count analysis -- w vs wf trts, S 600}
# test effect of w/wf trt -> StJean & Harrow S, 600
model.Mws<- lmer(M_count ~ Weediness + (1 | Year / Rep) + (1 | Location / Rep), data=datw2)
summary(model.Mws)
anova(model.Mws)

model.Mws.best<- get_model(lmerTest::step(model.Mws, reduce.random=F))
summary(model.Mws.best)
anova(model.Mws.best)

# check residuals
resid.model.Mws<- resid(model.Mws.best)
pred.model.Mws<- predict(model.Mws.best)

# check randomness
plot(pred.model.Mws, resid.model.Mws, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mws, main="Histogram of Residuals", xlab="Marketable cob count")

qqnorm(resid.model.Mws)

# Shapiro-Wilk test
shapiro.test(resid.model.Mws)

# means
Mwsemmeans<- emmeans(model.Mws.best, pairwise ~ Weediness)
Mwsemmeans
plot(Mwsemmeans, comparisons=T) # Harrow WF > StJean W & WF & Harrow W
```
*Best Model:*
M_count ~ Weediness + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
          Sum Sq Mean Sq NumDF  DenDF F value Pr(>F)  
Weediness 477.04  477.04     1 20.157  6.6321  0.018 *

*Assumptions:*
Not great distribution of residuals but not horrible

*Means:*
 Weediness emmean   SE   df lower.CL upper.CL
 W           15.4 11.9 1.33    -70.9      102
 WF          24.4 11.9 1.33    -62.0      111
 
 *Contrasts:*
 contrast estimate   SE   df t.ratio p.value
 W - WF      -8.92 3.46 13.2 -2.575  0.0228 *
 
 
```{r M corn count analysis -- wf trt vs ctrl, E & S all SR}
# test effect of trts
model.Mwf<- lmer(M_count ~ Trt_code + (1 | Year / Rep), data=Hdatwf)
summary(model.Mwf)
anova(model.Mwf)

model.Mwf.best<- get_model(lmerTest::step(model.Mwf, reduce.random=F))
summary(model.Mwf.best)
anova(model.Mwf.best)

# check residuals
resid.model.Mwf<- resid(model.Mwf.best)
pred.model.Mwf<- predict(model.Mwf.best)

# check randomness
plot(pred.model.Mwf, resid.model.Mwf, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwf, main="Histogram of Residuals", xlab="Marketable cob count")

qqnorm(resid.model.Mwf) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwf)

# means
Mwfemmeans<- emmeans(model.Mwf.best, pairwise ~ Trt_code)
Mwfemmeans
plot(Mwfemmeans, comparisons=T) # 
```
*Best Model:*
M_count ~ Trt_code + (1 | Year/Rep)

*Effects:*
         Sum Sq Mean Sq NumDF DenDF F value  Pr(>F)  
Trt_code 461.43  76.905     6    42  2.8657 0.01973 *

*Assumptions:*
Good -- one lower outlier but important data point

*Means:*
 Trt_code emmean   SE  df lower.CL upper.CL
 E1WF1N     30.9 2.96 2.2     19.2     42.6
 E2WF1N     33.0 2.96 2.2     21.3     44.7
 E3WF1N     35.1 2.96 2.2     23.4     46.8
 S1WF1N     26.0 2.96 2.2     14.3     37.7
 S2WF1N     29.9 2.96 2.2     18.2     41.6
 S3WF1N     31.4 2.96 2.2     19.7     43.1
 WF1N       34.5 2.96 2.2     22.8     46.2
 
 *Contrasts:*
 contrast        estimate   SE df t.ratio p.value
 E1WF1N - E2WF1N   -2.125 2.59 42 -0.820  0.9815 
 E1WF1N - E3WF1N   -4.250 2.59 42 -1.641  0.6575 
 E1WF1N - S1WF1N    4.875 2.59 42  1.882  0.5029 
 E1WF1N - S2WF1N    1.000 2.59 42  0.386  0.9997 
 E1WF1N - S3WF1N   -0.500 2.59 42 -0.193  1.0000 
 E1WF1N - WF1N     -3.625 2.59 42 -1.400  0.7990 
 E2WF1N - E3WF1N   -2.125 2.59 42 -0.820  0.9815 
 E2WF1N - S1WF1N    7.000 2.59 42  2.702  0.1228 
 E2WF1N - S2WF1N    3.125 2.59 42  1.206  0.8877 
 E2WF1N - S3WF1N    1.625 2.59 42  0.627  0.9955 
 E2WF1N - WF1N     -1.500 2.59 42 -0.579  0.9971 
 E3WF1N - S1WF1N    9.125 2.59 42  3.523  0.0167 *
 E3WF1N - S2WF1N    5.250 2.59 42  2.027  0.4138 
 E3WF1N - S3WF1N    3.750 2.59 42  1.448  0.7729 
 E3WF1N - WF1N      0.625 2.59 42  0.241  1.0000 
 S1WF1N - S2WF1N   -3.875 2.59 42 -1.496  0.7455 
 S1WF1N - S3WF1N   -5.375 2.59 42 -2.075  0.3856 
 S1WF1N - WF1N     -8.500 2.59 42 -3.282  0.0314 *
 S2WF1N - S3WF1N   -1.500 2.59 42 -0.579  0.9971 
 S2WF1N - WF1N     -4.625 2.59 42 -1.786  0.5647 
 S3WF1N - WF1N     -3.125 2.59 42 -1.206  0.8877
 
 
```{r M corn count analysis -- wf trt vs ctrl, E & S 600}
# test effect of trts
model.Mwf600<- lmer(M_count ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf1)
summary(model.Mwf600)
anova(model.Mwf)

model.Mwf600.best<- get_model(lmerTest::step(model.Mwf600, reduce.random=F))
summary(model.Mwf600.best)
anova(model.Mwf600.best)

# check residuals
resid.model.Mwf600<- resid(model.Mwf600.best)
pred.model.Mwf600<- predict(model.Mwf600.best)

# check randomness
plot(pred.model.Mwf600, resid.model.Mwf600, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwf600, main="Histogram of Residuals", xlab="Marketable cob count")

qqnorm(resid.model.Mwf600) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwf600)

# means
Mwf600emmeans<- emmeans(model.Mwf600.best, pairwise ~ Location)
Mwf600emmeans
plot(Mwf600emmeans, comparisons=T) # Harrow > StJean
```
*Best Model:*
M_count ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Fine -- not a lot of data

*Means:*
None
 
 
```{r M corn count analysis -- wf trt vs ctrl, S 600}
# test effect of trts
model.Mwfs<- lmer(M_count ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf2)
summary(model.Mwfs)
anova(model.Mwfs)

model.Mwfs.best<- get_model(lmerTest::step(model.Mwfs, reduce.random=F))
summary(model.Mwfs.best)
anova(model.Mwf.best)

# check residuals
resid.model.Mwfs<- resid(model.Mwfs.best)
pred.model.Mwfs<- predict(model.Mwfs.best)

# check randomness
plot(pred.model.Mwfs, resid.model.Mwfs, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwfs, main="Histogram of Residuals", xlab="Marketable cob count")

qqnorm(resid.model.Mwfs) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwfs)

# means
Mwfsemmeans<- emmeans(model.Mwfs.best, pairwise ~ Trt_code)
Mwfsemmeans
plot(Mwfsemmeans, comparisons=T) # Harrow NR & S > StJean NR > StJean S
```
*Best Model:*
M_count ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
         Sum Sq Mean Sq NumDF DenDF F value  Pr(>F)  
Trt_code 461.43  76.905     6    42  2.8657 0.01973 *

*Assumptions:*
Not great -- not a lot of data

*Means:*
 Trt_code emmean   SE   df lower.CL upper.CL
 S3WF1N     18.7 10.5 1.03   -104.8      142
 WF1N       26.7 10.5 1.03    -96.8      150
 
*Contrasts:*
 contrast      estimate   SE   df t.ratio p.value
 S3WF1N - WF1N       -8 2.72 13.3 -2.943  0.0112 *


```{r M corn count analysis -- wf trts, E & S all SR}
# test effect of trts
model.Mwftrt<- lmer(M_count ~ Cult * SR + (1 | Year / Rep), data=Hdatwftrt)
summary(model.Mwftrt)
anova(model.Mwftrt)

model.Mwftrt.best<- get_model(lmerTest::step(model.Mwftrt, reduce.random=F))
summary(model.Mwftrt.best)
anova(model.Mwftrt.best)

# check residuals
resid.model.Mwftrt<- resid(model.Mwftrt.best)
pred.model.Mwftrt<- predict(model.Mwftrt.best)

# check randomness
plot(pred.model.Mwftrt, resid.model.Mwftrt, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwftrt, main="Histogram of Residuals", xlab="Marketable cob count")

qqnorm(resid.model.Mwftrt) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwftrt)

# means
Mwftrtemmeans<- emmeans(model.Mwftrt.best, pairwise ~ Cult)
Mwftrtemmeans
plot(Mwftrtemmeans, comparisons=T) # E > S

Mwftrtemmeans1<- emmeans(model.Mwftrt.best, pairwise ~ SR)
Mwftrtemmeans1
plot(Mwftrtemmeans1, comparisons=T) # 600 > 150
```
*Best Model:*
M_count ~ Cult + SR + (1 | Year/Rep)

*Effects:*
     Sum Sq Mean Sq NumDF DenDF F value   Pr(>F)   
Cult 184.08 184.083     1    37  8.3722 0.006352 **
SR   189.04  94.521     2    37  4.2988 0.020955 * 

*Assumptions:*
Not great -- not a lot of data

*Means:*
 Cult     emmean   SE  df lower.CL upper.CL
 Early      33.0 3.12 1.1     1.06     64.9
 Standard   29.1 3.12 1.1    -2.86     61.0
 
 SR  emmean   SE   df lower.CL upper.CL
 150   28.4 3.19 1.21     1.18     55.7
 300   31.4 3.19 1.21     4.18     58.7
 600   33.2 3.19 1.21     5.99     60.5
 
*Contrasts:*
 contrast         estimate   SE df t.ratio p.value
 Early - Standard     3.92 1.35 37 2.893   0.0064 *

 contrast  estimate   SE df t.ratio p.value
 150 - 300    -3.00 1.66 37 -1.810  0.1805 
 150 - 600    -4.81 1.66 37 -2.903  0.0167 *
 300 - 600    -1.81 1.66 37 -1.093  0.5242 
 
 
```{r M corn count analysis -- wf trts, E & S 600}
# test effect of trts
model.Mwftrt600<- lmer(M_count ~ Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datwftrt1)
summary(model.Mwftrt600)
anova(model.Mwftrt600)

model.Mwftrt600.best<- get_model(lmerTest::step(model.Mwftrt600, reduce.random=F))
summary(model.Mwftrt600.best)
anova(model.Mwftrt600.best)

# check residuals
resid.model.Mwftrt600<- resid(model.Mwftrt600.best)
pred.model.Mwftrt600<- predict(model.Mwftrt600.best)

# check randomness
plot(pred.model.Mwftrt600, resid.model.Mwftrt600, ylab="Residuals", xlab="Marketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwftrt600, main="Histogram of Residuals", xlab="Marketable cob count")

qqnorm(resid.model.Mwftrt600) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwftrt600)

# means
```
*Best Model:*
M_count ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Okay

*Means:*
None


### Marketable corn weight

```{r M corn wt}
# plot of marketable cob weight by cultivar & seeding rate, separated by location & year
Mwtplot1<- ggplot(datw, aes(x = Trt_code, y = M_wt, fill=factor(SR))) +
          geom_boxplot() +
          facet_wrap(Location~Year)+
          theme_bw()
print(Mwtplot1)
```

```{r M corn wt analysis -- trt vs ctrl}
# model analysis for marketable cob weight trt vs ctrl
model.Mwt<- lmer(M_wt ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datw)
summary(model.Mwt)
anova(model.Mwt)

model.Mwt.best<- get_model(lmerTest::step(model.Mwt, reduce.random=F))
summary(model.Mwt.best)
anova(model.Mwt.best)

# check residuals
resid.model.Mwt<- resid(model.Mwt.best)
pred.model.Mwt<- predict(model.Mwt.best)

# check randomness
plot(pred.model.Mwt, resid.model.Mwt, ylab="Residuals", xlab="Marketable cob weight", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwt, main="Histogram of Residuals", xlab="Marketable cob weight")

qqnorm(resid.model.Mwt) # messy on ends

# Shapiro-Wilk test
shapiro.test(resid.model.Mwt)

# means
Mwtemmeans<- emmeans(model.Mwt.best, pairwise ~ Trt_code)
Mwtemmeans
plot(Mwtemmeans, comparisons=T) # WF > trts & W (W slightly lower than trts, not signif)
```
*Best Model:*
M_wt ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
            Sum Sq  Mean Sq NumDF  DenDF F value    Pr(>F)    
Trt_code 584530576 83504368     7 159.67  19.132 < 2.2e-16 ***

*Assumptions:*
Fine

*Means:*
 Trt_code emmean   SE   df lower.CL upper.CL
 E1W1N      1480 1568 4.50    -2689     5648
 E2W1N      1677 1568 4.50    -2492     5845
 E3W1N      1663 1568 4.50    -2506     5832
 S1W1N      1836 1555 4.36    -2344     6017
 S2W1N      2184 1555 4.36    -1996     6365
 S3W1N      2672 1555 4.36    -1509     6853
 W1N         741 1555 4.36    -3440     4921
 WF1N       6836 1555 4.36     2655    11017
 
*Contrasts:*
 contrast      estimate  SE  df t.ratio p.value
 E1W1N - E2W1N   -197.0 661 156  -0.298 1.0000 
 E1W1N - E3W1N   -183.1 661 156  -0.277 1.0000 
 E1W1N - S1W1N   -356.7 636 156  -0.561 0.9993 
 E1W1N - S2W1N   -704.7 636 156  -1.108 0.9543 
 E1W1N - S3W1N  -1192.1 636 156  -1.874 0.5707 
 E1W1N - W1N      739.1 636 156   1.162 0.9413 
 E1W1N - WF1N   -5355.9 636 156  -8.420 <.0001 *
 E2W1N - E3W1N     13.9 661 156   0.021 1.0000 
 E2W1N - S1W1N   -159.7 636 156  -0.251 1.0000 
 E2W1N - S2W1N   -507.7 636 156  -0.798 0.9930 
 E2W1N - S3W1N   -995.0 636 156  -1.564 0.7706 
 E2W1N - W1N      936.1 636 156   1.472 0.8213 
 E2W1N - WF1N   -5158.9 636 156  -8.111 <.0001 *
 E3W1N - S1W1N   -173.6 636 156  -0.273 1.0000 
 E3W1N - S2W1N   -521.5 636 156  -0.820 0.9918 
 E3W1N - S3W1N  -1008.9 636 156  -1.586 0.7579 
 E3W1N - W1N      922.2 636 156   1.450 0.8323 
 E3W1N - WF1N   -5172.8 636 156  -8.133 <.0001 *
 S1W1N - S2W1N   -348.0 603 156  -0.577 0.9991 
 S1W1N - S3W1N   -835.4 603 156  -1.385 0.8628 
 S1W1N - W1N     1095.8 603 156   1.817 0.6096 
 S1W1N - WF1N   -4999.3 603 156  -8.289 <.0001 *
 S2W1N - S3W1N   -487.4 603 156  -0.808 0.9925 
 S2W1N - W1N     1443.7 603 156   2.394 0.2517 
 S2W1N - WF1N   -4651.3 603 156  -7.712 <.0001 *
 S3W1N - W1N     1931.1 603 156   3.202 0.0345 
 S3W1N - WF1N   -4163.9 603 156  -6.904 <.0001 *
 W1N - WF1N     -6095.0 603 156 -10.106 <.0001 *


```{r M corn wt analysis -- trts}
# model analysis for marketable cob weight trts
model.Mwt.trt<- lmer(M_wt ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.Mwt.trt)
anova(model.Mwt.trt)

model.Mwt.trt.best<- get_model(lmerTest::step(model.Mwt.trt, reduce.random=F))
summary(model.Mwt.trt.best)
anova(model.Mwt.trt.best)

# check residuals
resid.model.Mwttrt<- resid(model.Mwt.trt.best)
pred.model.Mwttrt<- predict(model.Mwt.trt.best)

# check randomness
plot(pred.model.Mwttrt, resid.model.Mwttrt, ylab="Residuals", xlab="Marketable cob weight", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwttrt, main="Histogram of Residuals", xlab="Marketable cob weight")

qqnorm(resid.model.Mwttrt) #

# Shapiro-Wilk test
shapiro.test(resid.model.Mwttrt)

# means
Mwtemmeans<- emmeans(model.Mwt.trt.best, pairwise ~ Cult)
Mwtemmeans
plot(Mwtemmeans, comparisons=T) # Std > Early
```
*Best Model:*
M_wt ~ Cult + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
       Sum Sq  Mean Sq NumDF DenDF F value   Pr(>F)   
Cult 19352817 19352817     1 117.9  7.7698 0.006194 **

*Assumptions:*
Good

*Means:*
 Cult     emmean   SE   df lower.CL upper.CL
 Early      1466 1912 3.49    -4159     7091
 Standard   2253 1909 3.48    -3378     7885

*Contrasts:*
 contrast         estimate  SE  df t.ratio p.value
 Early - Standard     -787 283 114 -2.784  0.0063 *


```{r M corn wt analysis -- w vs wf trts, E & S all SR}
# test effect of w/wf trt -> Harrow E & S, all SR
model.Mwtw<- lmer(M_wt ~ Weediness * Cult * SR + (1 | Year / Rep), data=Hdatw)
summary(model.Mwtw)
anova(model.Mwtw)

model.Mwtw.best<- get_model(lmerTest::step(model.Mwtw, reduce.random=F))
summary(model.Mwtw.best)
anova(model.Mwtw.best)

# check residuals
resid.model.Mwtw<- resid(model.Mwtw.best)
pred.model.Mwtw<- predict(model.Mwtw.best)

# check randomness
plot(pred.model.Mwtw, resid.model.Mwtw, ylab="Residuals", xlab="M cob wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwtw, main="Histogram of Residuals", xlab="M cob wt")

qqnorm(resid.model.Mwtw)

# Shapiro-Wilk test
shapiro.test(resid.model.Mwtw)

# means
Mwtwemmeans<- emmeans(model.Mwtw.best, pairwise ~ Weediness:Cult)
Mwtwemmeans
plot(Mwtwemmeans, comparisons=T)

# weediness by cultivar interacton:
## Std: WF > W
## Early: WF > W
## W Early = W Std, WF Early = WF
```
*Best Model:*
M_wt ~ Weediness + Cult + (1 | Year/Rep) + Weediness:Cult

*Effects:*
                  Sum Sq   Mean Sq NumDF DenDF  F value  Pr(>F)    
Weediness      451838728 451838728     1    91 105.7620 < 2e-16 ***
Cult                 221       221     1    91   0.0001 0.99428    
Weediness:Cult  18583752  18583752     1    91   4.3499 0.03981 * 

*Assumptions:*
Not great -- not enough data

*Means:*
 Weediness Cult     emmean   SE   df lower.CL upper.CL
 W         Early      3727 2674 1.04   -27424    34879
 WF        Early      8946 2674 1.04   -22205    40097
 W         Standard   4610 2674 1.04   -26541    35761
 WF        Standard   8069 2674 1.04   -23082    39220

*Contrasts:*
 contrast                 estimate  SE df t.ratio p.value
 W Early - WF Early          -5219 597 85 -8.747  <.0001 *
 W Early - W Standard         -883 597 85 -1.480  0.4541 
 W Early - WF Standard       -4342 597 85 -7.277  <.0001 *
 WF Early - W Standard        4336 597 85  7.267  <.0001 *
 WF Early - WF Standard        877 597 85  1.470  0.4602 
 W Standard - WF Standard    -3459 597 85 -5.797  <.0001 *
 
 
```{r M corn wt analysis -- w vs wf trts, E & S 600}
# test effect of w/wf trt -> Harrow & StJean E & S, 600
model.Mwtw600<- lmer(M_wt ~ Weediness * Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datw1)
summary(model.Mwtw600)
anova(model.Mwtw600)

model.Mwtw600.best<- get_model(lmerTest::step(model.Mwtw600, reduce.random=F))
summary(model.Mwtw600.best)
anova(model.Mwtw600.best)

# check residuals
resid.model.Mwtw600<- resid(model.Mwtw600.best)
pred.model.Mwtw600<- predict(model.Mwtw600.best)

# check randomness
plot(pred.model.Mwtw600, resid.model.Mwtw600, ylab="Residuals", xlab="M cob wt", main="Predictecd vs Residuals") 

# check normality
hist(resid.model.Mwtw600, main="Histogram of Residuals", xlab="M cob wt")

qqnorm(resid.model.Mwtw600)

# Shapiro-Wilk test
shapiro.test(resid.model.Mwtw600)

# means
Mwtw600emmeans<- emmeans(model.Mwtw600.best, pairwise ~ Weediness)
Mwtw600emmeans
plot(Mwtw600emmeans, comparisons=T) 

# weediness effect by location:
## Harrow: WF > W, StJean: W = WF
```
*Best Model:*
M_wt ~ Weediness + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
             Sum Sq   Mean Sq NumDF  DenDF F value    Pr(>F)    
Weediness 137022539 137022539     1 43.959  25.739 7.579e-06 ***

*Assumptions:*
Not great -- square-like hist

*Means:*
 Weediness emmean   SE   df lower.CL upper.CL
 W           2171 4059 1.97   -15559    19900
 WF          5550 4059 1.97   -12180    23279

*Contrasts:*
 contrast estimate  SE   df t.ratio p.value
 W - WF      -3379 666 37.2 -5.073  <.0001 *
 
 
```{r M corn wt analysis -- w vs wf trts, S 600}
# test effect of w/wf trt ->  S, 600
model.Mwtws<- lmer(M_wt ~ Weediness + (1 | Year / Rep) + (1 | Location / Rep), data=datw2)
summary(model.Mwtws)
anova(model.Mwtws)

model.Mwtws.best<- get_model(lmerTest::step(model.Mwtws, reduce.random=F))
summary(model.Mwtws.best)
anova(model.Mwtws.best)

# check residuals
resid.model.Mwtws<- resid(model.Mwtws.best)
pred.model.Mwtws<- predict(model.Mwtws.best)

# check randomness
plot(pred.model.Mwtws, resid.model.Mwtws, ylab="Residuals", xlab="M cob wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mws, main="Histogram of Residuals", xlab="M cob wt")

qqnorm(resid.model.Mwtws)

# Shapiro-Wilk test
shapiro.test(resid.model.Mwtws)

# means
Mwtwsemmeans<- emmeans(model.Mwtws.best, pairwise ~ Weediness)
Mwtwsemmeans
plot(Mwtwsemmeans, comparisons=T)
```
*Best Model:*
M_wt ~ Weediness + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
            Sum Sq  Mean Sq NumDF  DenDF F value  Pr(>F)  
Weediness 32868461 32868461     1 20.103  7.1519 0.01453 *

*Assumptions:*
Not great -- not enough data

*Means:*
 Weediness emmean   SE   df lower.CL upper.CL
 W           4416 3859 1.31   -24321    33152
 WF          6756 3859 1.31   -21980    35493

*Contrasts:*
 contrast estimate  SE   df t.ratio p.value
 W - WF      -2341 875 13.2 -2.674  0.0189 *
 
 
```{r M corn wt analysis -- wf trt vs ctrl, E & S all SR}
# test effect of trts
model.Mwtwf<- lmer(M_wt ~ Trt_code + (1 | Year / Rep), data=Hdatwf)
summary(model.Mwtwf)
anova(model.Mwtwf)

model.Mwtwf.best<- get_model(lmerTest::step(model.Mwtwf, reduce.random=F))
summary(model.Mwtwf.best)
anova(model.Mwtwf.best)

# check residuals
resid.model.Mwtwf<- resid(model.Mwtwf.best)
pred.model.Mwtwf<- predict(model.Mwtwf.best)

# check randomness
plot(pred.model.Mwtwf, resid.model.Mwtwf, ylab="Residuals", xlab="M cob wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwtwf, main="Histogram of Residuals", xlab="M cob wt")

qqnorm(resid.model.Mwtwf) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwtwf)

# no main effects
```
*Best Model:*
M_wt ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Not great -- not enough data

*Means:*
None
 
 
```{r M corn wt analysis -- wf trt vs ctrl, E & S 600}
# test effect of trts
model.Mwt600wf<- lmer(M_wt ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf1)
summary(model.Mwt600wf)
anova(model.Mwt600wf)

model.Mwt600wf.best<- get_model(lmerTest::step(model.Mwt600wf, reduce.random=F))
summary(model.Mwt600wf.best)
anova(model.Mwt600wf.best)

# check residuals
resid.model.Mwt600wf<- resid(model.Mwt600wf.best)
pred.model.Mwt600wf<- predict(model.Mwt600wf.best)

# check randomness
plot(pred.model.Mwt600wf, resid.model.Mwt600wf, ylab="Residuals", xlab="M cob wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwt600wf, main="Histogram of Residuals", xlab="M cob wt")

qqnorm(resid.model.Mwt600wf) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwt600wf)

# means
```
*Best Model:*
M_wt ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not horrible

*Means:*
None


```{r M corn wt analysis -- wf trt vs ctrl, S 600}
# test effect of trts
model.Mwtswf<- lmer(M_wt ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf2)
summary(model.Mwtswf)
anova(model.Mwtswf)

model.Mwtswf.best<- get_model(lmerTest::step(model.Mwtswf, reduce.random=F))
summary(model.Mwtswf.best)
anova(model.Mwtswf.best)

# check residuals
resid.model.Mwtswf<- resid(model.Mwtswf.best)
pred.model.Mwtswf<- predict(model.Mwtswf.best)

# check randomness
plot(pred.model.Mwtswf, resid.model.Mwtswf, ylab="Residuals", xlab="M cob wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwtswf, main="Histogram of Residuals", xlab="M cob wt")

qqnorm(resid.model.Mwtswf) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwtswf)

# means
Mwtswfemmeans<- emmeans(model.Mwtswf.best, pairwise ~ Trt_code)
Mwtswfemmeans
plot(Mwtswfemmeans, comparisons=T) # NR > S
```
*Best Model:*
M_wt ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
           Sum Sq  Mean Sq NumDF  DenDF F value  Pr(>F)  
Trt_code 19951789 19951789     1 20.147  6.2229 0.02141 *

*Assumptions:*
Bad -- messy hist of residuals

*Means:*
 Trt_code emmean   SE   df lower.CL upper.CL
 S3WF1N     4912 3773 1.05   -37520    47344
 WF1N       6736 3773 1.05   -35697    49168

*Contrasts:*
 contrast      estimate  SE   df t.ratio p.value
 S3WF1N - WF1N    -1824 731 13.2 -2.495  0.0266 *


```{r M corn wt analysis -- wf trts, E & S all SR}
# test effect of trts
model.Mwtwftrt<- lmer(M_wt ~ Cult * SR + (1 | Year / Rep), data=Hdatwftrt)
summary(model.Mwtwftrt)
anova(model.Mwtwftrt)

model.Mwtwftrt.best<- get_model(lmerTest::step(model.Mwtwftrt, reduce.random=F))
summary(model.Mwtwftrt.best)
anova(model.Mwtwftrt.best)

# check residuals
resid.model.Mwtwftrt<- resid(model.Mwtwftrt.best)
pred.model.Mwtwftrt<- predict(model.Mwtwftrt.best)

# check randomness
plot(pred.model.Mwtwftrt, resid.model.Mwtwftrt, ylab="Residuals", xlab="M cob wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwtwftrt, main="Histogram of Residuals", xlab="M cob wt")

qqnorm(resid.model.Mwtwftrt) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwtwftrt)

# no main effects
```
*Best Model:*
M_wt ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Not horrible

*Means:*
None
 
 
```{r M corn wt analysis -- wf trts, E & S 600}
# test effect of trts
model.Mwtwftrt600<- lmer(M_wt ~ Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datwftrt1)
summary(model.Mwtwftrt600)
anova(model.Mwtwftrt600)

model.Mwtwftrt600.best<- get_model(lmerTest::step(model.Mwtwftrt600, reduce.random=F))
summary(model.Mwtwftrt600.best)
anova(model.Mwtwftrt600.best)

# check residuals
resid.model.Mwtwftrt600<- resid(model.Mwtwftrt600.best)
pred.model.Mwtwftrt600<- predict(model.Mwtwftrt600.best)

# check randomness
plot(pred.model.Mwtwftrt600, resid.model.Mwtwftrt600, ylab="Residuals", xlab="M cob wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.Mwtwftrt600, main="Histogram of Residuals", xlab="M cob wt")

qqnorm(resid.model.Mwtwftrt600) 

# Shapiro-Wilk test
shapiro.test(resid.model.Mwtwftrt600)

# means
```
*Best Model:*
M_wt ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not horrible

*Means:*
None



### Unmarketable corn count

```{r UM corn count}
# plot of unmarketable cob count by cultivar & seeding rate, separated by location & year
UMplot1<- ggplot(datw, aes(x = Trt_code, y = UM_count, fill=factor(SR))) +
          geom_boxplot() +
          facet_wrap(Location~Year)+
          theme_bw()
print(UMplot1)
```

``` {r UM corn count analysis -- trt vs ctrl}
# model analysis for unmarketable cob count trt vs ctrl
model.UM<- lmer(UM_count ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datw)
summary(model.UM)
anova(model.UM)

model.UM.best<- get_model(lmerTest::step(model.UM, reduce.random=F))
summary(model.UM.best)
anova(model.UM.best)

# check residuals
resid.model.UM<- resid(model.UM.best)
pred.model.UM<- predict(model.UM.best)

# check randomness
plot(pred.model.UM, resid.model.UM, ylab="Residuals", xlab="Unmarketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UM, main="Histogram of Residuals", xlab="Unmarketable cob count")

qqnorm(resid.model.UM) 

# Shapiro-Wilk test
shapiro.test(resid.model.UM)

# means
UMcountemmeans<- emmeans(model.UM.best, pairwise ~ Trt_code)
UMcountemmeans
plot(UMcountemmeans, comparisons=T) # WF > W, S3 > W, Trts = WF
```
*Best Model:*
UM_count ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
         Sum Sq Mean Sq NumDF  DenDF F value   Pr(>F)   
Trt_code 956.19   136.6     7 161.56  3.3927 0.002086 **

*Assumptions:*
Good

*Means:*
 Trt_code emmean   SE   df lower.CL upper.CL
 E1W1N      19.0 5.39 3.13    2.231     35.7
 E2W1N      19.6 5.39 3.13    2.801     36.3
 E3W1N      18.6 5.39 3.13    1.881     35.4
 S1W1N      21.3 5.35 3.05    4.461     38.2
 S2W1N      21.3 5.35 3.05    4.402     38.2
 S3W1N      23.6 5.35 3.05    6.702     40.5
 W1N        17.4 5.35 3.05    0.565     34.3
 WF1N       24.4 5.35 3.05    7.498     41.3

*Contrasts:*
 contrast      estimate   SE  df t.ratio p.value
 E1W1N - E2W1N  -0.5700 2.01 156 -0.284  1.0000 
 E1W1N - E3W1N   0.3500 2.01 156  0.174  1.0000 
 E1W1N - S1W1N  -2.3532 1.93 156 -1.218  0.9255 
 E1W1N - S2W1N  -2.2948 1.93 156 -1.188  0.9343 
 E1W1N - S3W1N  -4.5949 1.93 156 -2.378  0.2594 
 E1W1N - W1N     1.5427 1.93 156  0.799  0.9930 
 E1W1N - WF1N   -5.3907 1.93 156 -2.790  0.1049 
 E2W1N - E3W1N   0.9200 2.01 156  0.458  0.9998 
 E2W1N - S1W1N  -1.7832 1.93 156 -0.923  0.9834 
 E2W1N - S2W1N  -1.7248 1.93 156 -0.893  0.9863 
 E2W1N - S3W1N  -4.0248 1.93 156 -2.083  0.4303 
 E2W1N - W1N     2.1126 1.93 156  1.094  0.9573 
 E2W1N - WF1N   -4.8207 1.93 156 -2.495  0.2052 
 E3W1N - S1W1N  -2.7032 1.93 156 -1.399  0.8564 
 E3W1N - S2W1N  -2.6448 1.93 156 -1.369  0.8699 
 E3W1N - S3W1N  -4.9448 1.93 156 -2.560  0.1790 
 E3W1N - W1N     1.1926 1.93 156  0.617  0.9986 
 E3W1N - WF1N   -5.7407 1.93 156 -2.972  0.0659 
 S1W1N - S2W1N   0.0583 1.83 156  0.032  1.0000 
 S1W1N - S3W1N  -2.2417 1.83 156 -1.224  0.9237 
 S1W1N - W1N     3.8958 1.83 156  2.127  0.4025 
 S1W1N - WF1N   -3.0375 1.83 156 -1.658  0.7139 
 S2W1N - S3W1N  -2.3000 1.83 156 -1.256  0.9134 
 S2W1N - W1N     3.8375 1.83 156  2.095  0.4227 
 S2W1N - WF1N   -3.0958 1.83 156 -1.690  0.6936 
 S3W1N - W1N     6.1375 1.83 156  3.351  0.0221 *
 S3W1N - WF1N   -0.7958 1.83 156 -0.434  0.9999 
 W1N - WF1N     -6.9333 1.83 156 -3.785  0.0053 *


```{r UM corn count analysis -- trts}
# model analysis for unmarketable cob count trts
model.UM.trt<- lmer(UM_count ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.UM.trt)
anova(model.UM.trt)

model.UM.trt.best<- get_model(lmerTest::step(model.UM.trt, reduce.random=F))
summary(model.UM.trt.best)
anova(model.UM.trt.best)

# check residuals
resid.model.UMtrt<- resid(model.UM.trt.best)
pred.model.UMtrt<- predict(model.UM.trt.best)

# check randomness
plot(pred.model.UMtrt, resid.model.UMtrt, ylab="Residuals", xlab="Unmarketable cob count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMtrt, main="Histogram of Residuals", xlab="Unmarketable cob count")

qqnorm(resid.model.UMtrt) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMtrt)

# means
UMcountemmeans<- emmeans(model.UM.trt.best, pairwise ~ Cult)
UMcountemmeans
plot(UMcountemmeans, comparisons=T) # Std > Early
```
*Best Model:*
UM_count ~ Cult + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
     Sum Sq Mean Sq NumDF  DenDF F value   Pr(>F)   
Cult 283.73  283.73     1 119.55  7.8665 0.005879 **

*Assumptions:*
Good

*Means:*
 Cult     emmean   SE   df lower.CL upper.CL
 Early      19.2 4.84 2.74     2.95     35.5
 Standard   22.2 4.82 2.70     5.89     38.6

*Contrasts:*
 contrast         estimate   SE  df t.ratio p.value
 Early - Standard    -3.01 1.08 114 -2.796  0.0061 *


```{r UM corn count analysis -- w vs wf trts, E & S all SR}
# test effect of w/wf trt -> Harrow E & S, all SR
model.UMw<- lmer(UM_count ~ Weediness * Cult * SR + (1 | Year / Rep), data=Hdatw)
summary(model.UMw)
anova(model.UMw)

model.UMw.best<- get_model(lmerTest::step(model.UMw, reduce.random=F))
summary(model.UMw.best)
anova(model.UMw.best)

# check residuals
resid.model.UMw<- resid(model.UMw.best)
pred.model.UMw<- predict(model.UMw.best)

# check randomness
plot(pred.model.UMw, resid.model.UMw, ylab="Residuals", xlab="UM count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMw, main="Histogram of Residuals", xlab="UM count")

qqnorm(resid.model.UMw)

# Shapiro-Wilk test
shapiro.test(resid.model.UMw)

# no main effects to compare means

# no effect of weediness
```
*Best Model:*
UM_count ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Good

*Means:*
None
 
 
```{r UM corn count analysis -- w vs wf trts, E & S 600}
# test effect of w/wf trt -> Harrow & StJean E & S, 600
model.UMw600<- lmer(UM_count ~ Weediness * Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datw1)
summary(model.UMw600)
anova(model.UMw600)

model.UMw600.best<- get_model(lmerTest::step(model.UMw600, reduce.random=F))
summary(model.UMw600.best)
anova(model.UMw600.best)

# check residuals
resid.model.UMw600<- resid(model.UMw600.best)
pred.model.UMw600<- predict(model.UMw600.best)

# check randomness
plot(pred.model.UMw600, resid.model.UMw600, ylab="Residuals", xlab="UM count", main="Predictecd vs Residuals") 

# check normality
hist(resid.model.UMw600, main="Histogram of Residuals", xlab="UM count")

qqnorm(resid.model.UMw600)

# Shapiro-Wilk test
shapiro.test(resid.model.UMw600)

# means
UMw600emmeans<- emmeans(model.UMw600.best, pairwise ~ Weediness*Cult)
UMw600emmeans
plot(UMw600emmeans, comparisons=T)

# weediness by cultivar interaction:
## Early: WF > W
## Std: W = WF
```
*Best Model:*
UM_count ~ Weediness * Cult + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
               Sum Sq Mean Sq NumDF  DenDF F value  Pr(>F)  
Weediness      135.00  135.00     1 36.561  3.4226 0.07240 .
Cult            29.61   29.61     1 36.561  0.7507 0.39192  
Weediness:Cult 168.38  168.38     1 36.561  4.2686 0.04596 *

*Assumptions:*
Not great -- not a lot of data

*Means:*
 Weediness Cult     emmean   SE   df lower.CL upper.CL
 W         Early      18.4 7.31 1.55    -23.6     60.4
 WF        Early      25.5 7.31 1.55    -16.5     67.5
 W         Standard   23.7 7.31 1.55    -18.3     65.7
 WF        Standard   23.3 7.31 1.55    -18.6     65.3
 
*Contrasts:*
 contrast                 estimate   SE   df t.ratio p.value
 W Early - WF Early         -7.100 2.56 34.9 -2.769  0.0424 *
 W Early - W Standard       -5.317 2.56 34.9 -2.074  0.1817 
 W Early - WF Standard      -4.925 2.56 34.9 -1.921  0.2381 
 WF Early - W Standard       1.783 2.56 34.9  0.696  0.8981 
 WF Early - WF Standard      2.175 2.56 34.9  0.848  0.8310 
 W Standard - WF Standard    0.392 2.56 34.9  0.153  0.9987 


```{r UM corn count analysis -- w vs wf trts, S 600}
# test effect of w/wf trt -> S, 600
model.UMws<- lmer(UM_count ~ Weediness + (1 | Year / Rep) + (1 | Location / Rep), data=datw2)
summary(model.UMws)
anova(model.UMws)

model.UMws.best<- get_model(lmerTest::step(model.UMws, reduce.random=F))
summary(model.UMws.best)
anova(model.UMws.best)

# check residuals
resid.model.UMws<- resid(model.UMws.best)
pred.model.UMws<- predict(model.UMws.best)

# check randomness
plot(pred.model.UMws, resid.model.UMws, ylab="Residuals", xlab="UM count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMws, main="Histogram of Residuals", xlab="UM count")

qqnorm(resid.model.UMws)

# Shapiro-Wilk test
shapiro.test(resid.model.UMws)

# no main effects to compare means

# no effect of weediness
```
*Best Model:*
UM_count ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Bad -- not a lot of data, hist messy

*Means:*
None
 
 
```{r UM corn count analysis -- wf trt vs ctrl, E & S all SR}
# test effect of trts
model.UMwf<- lmer(UM_count ~ Trt_code + (1 | Year / Rep), data=Hdatwf)
summary(model.UMwf)
anova(model.UMwf)

model.UMwf.best<- get_model(lmerTest::step(model.UMwf, reduce.random=F))
summary(model.UMwf.best)
anova(model.UMwf.best)

# check residuals
resid.model.UMwf<- resid(model.UMwf.best)
pred.model.UMwf<- predict(model.UMwf.best)

# check randomness
plot(pred.model.UMwf, resid.model.UMwf, ylab="Residuals", xlab="UM count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwf, main="Histogram of Residuals", xlab="UM count")

qqnorm(resid.model.UMwf) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwf)

# no main effects
```
*Best Model:*
UM_count ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Not great -- hist square-like

*Means:*
None


```{r UM corn count analysis -- wf trt vs ctrl, E & S 600}
# test effect of trts
model.UMwf600<- lmer(UM_count ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf1)
summary(model.UMwf600)
anova(model.UMwf)

model.UMwf600.best<- get_model(lmerTest::step(model.UMwf600, reduce.random=F))
summary(model.UMwf600.best)
anova(model.UMwf600.best)

# check residuals
resid.model.UMwf600<- resid(model.UMwf600.best)
pred.model.UMwf600<- predict(model.UMwf600.best)

# check randomness
plot(pred.model.UMwf600, resid.model.UMwf600, ylab="Residuals", xlab="UM count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwf600, main="Histogram of Residuals", xlab="UM count")

qqnorm(resid.model.UMwf600) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwf600)

# means
```
*Best Model:*
UM_count ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not great -- not a lot of data

*Means:*
None


```{r UM corn count analysis -- wf trt vs ctrl, S 600}
# test effect of trts
model.UMwfs<- lmer(UM_count ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf2)
summary(model.UMwfs)
anova(model.UMwfs)

model.UMwfs.best<- get_model(lmerTest::step(model.UMwfs, reduce.random=F))
summary(model.UMwfs.best)
anova(model.UMwf.best)

# check residuals
resid.model.UMwfs<- resid(model.UMwfs.best)
pred.model.UMwfs<- predict(model.UMwfs.best)

# check randomness
plot(pred.model.UMwfs, resid.model.UMwfs, ylab="Residuals", xlab="UM count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwfs, main="Histogram of Residuals", xlab="UM count")

qqnorm(resid.model.UMwfs) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwfs)

# no main effects
```
*Best Model:*
UM_count ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Bad -- hist 3 peaked, pred vs res split

*Means:*
None


```{r UM corn count analysis -- wf trts, E & S all SR}
# test effect of trts
model.UMwftrt<- lmer(UM_count ~ Cult * SR + (1 | Year / Rep), data=Hdatwftrt)
summary(model.UMwftrt)
anova(model.UMwftrt)

model.UMwftrt.best<- get_model(lmerTest::step(model.UMwftrt, reduce.random=F))
summary(model.UMwftrt.best)
anova(model.UMwftrt.best)

# check residuals
resid.model.UMwftrt<- resid(model.UMwftrt.best)
pred.model.UMwftrt<- predict(model.UMwftrt.best)

# check randomness
plot(pred.model.UMwftrt, resid.model.UMwftrt, ylab="Residuals", xlab="UM count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwftrt, main="Histogram of Residuals", xlab="UM count")

qqnorm(resid.model.UMwftrt) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwftrt)

# no main effects
```
*Best Model:*
UM_count ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Fine

*Means:*
None


```{r UM corn count analysis -- wf trts, E & S 600}
# test effect of trts
model.UMwftrt600<- lmer(UM_count ~ Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datwftrt1)
summary(model.UMwftrt600)
anova(model.UMwftrt600)

model.UMwftrt600.best<- get_model(lmerTest::step(model.UMwftrt600, reduce.random=F))
summary(model.UMwftrt600.best)
anova(model.UMwftrt600.best)

# check residuals
resid.model.UMwftrt600<- resid(model.UMwftrt600.best)
pred.model.UMwftrt600<- predict(model.UMwftrt600.best)

# check randomness
plot(pred.model.UMwftrt600, resid.model.UMwftrt600, ylab="Residuals", xlab="UM count", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwftrt600, main="Histogram of Residuals", xlab="UM count")

qqnorm(resid.model.UMwftrt600) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwftrt600)

# means
```
*Best Model:*
UM_count ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Good but not a lot of data

*Means:*
None

### Unmarketable corn weight

```{r UM corn wt}
# plot of unmarketable cob weight by cultivar & seeding rate, separated by location & year
UMwtplot1<- ggplot(datw, aes(x = Trt_code, y = UM_wt, fill=factor(SR))) +
          geom_boxplot() +
          facet_wrap(Location~Year)+
          theme_bw()
print(UMwtplot1)
```

```{r UM corn wt analysis -- trt vs ctrl}
# model analysis for unmarketable cob weight trt vs ctrl
model.UMwt<- lmer(UM_wt ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datw)
summary(model.UMwt)
anova(model.UMwt)

model.UMwt.best<- get_model(lmerTest::step(model.UMwt, reduce.random=F))
summary(model.UMwt.best)
anova(model.UMwt.best)

# check residuals
resid.model.UMwt<- resid(model.UMwt.best)
pred.model.UMwt<- predict(model.UMwt.best)

# check randomness
plot(pred.model.UMwt, resid.model.UMwt, ylab="Residuals", xlab="UnMarketable cob weight", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwt, main="Histogram of Residuals", xlab="UnMarketable cob weight")

qqnorm(resid.model.UMwt)

# Shapiro-Wilk test
shapiro.test(resid.model.UMwt)

# means
```
*Best Model:*
UM_wt ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
slightly right skewed -- outliers?

*Means:*
None


```{r UM corn wt analysis -- trts}
# model analysis for unmarketable cob weight trt vs ctrl
model.UMwt.trt<- lmer(UM_wt ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=datwtrt)
summary(model.UMwt.trt)
anova(model.UMwt.trt)

model.UMwt.trt.best<- get_model(lmerTest::step(model.UMwt.trt, reduce.random=F))
summary(model.UMwt.trt.best)
anova(model.UMwt.trt.best)

# check residuals
resid.model.UMwttrt<- resid(model.UMwt.trt.best)
pred.model.UMwttrt<- predict(model.UMwt.trt.best)

# check randomness
plot(pred.model.UMwttrt, resid.model.UMwttrt, ylab="Residuals", xlab="UnMarketable cob weight", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwttrt, main="Histogram of Residuals", xlab="UnMarketable cob weight")

qqnorm(resid.model.UMwttrt) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwttrt)

# means
UMwtemmeans1<- emmeans(model.UMwt.trt.best, pairwise ~ Location)
UMwtemmeans1
plot(UMwtemmeans1, comparisons=T) # Harrow & StJean > Agassiz
```
*Best Model:*
UM_wt ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
fine

*Means:*
None


```{r UM corn wt analysis -- w vs wf trts, E & S all SR}
# test effect of w/wf trt -> Harrow E & S, all SR
model.UMwtw<- lmer(UM_wt ~ Weediness * Cult * SR + (1 | Year / Rep), data=Hdatw)
summary(model.UMwtw)
anova(model.UMwtw)

model.UMwtw.best<- get_model(lmerTest::step(model.UMwtw, reduce.random=F))
summary(model.UMwtw.best)
anova(model.UMwtw.best)

# check residuals
resid.model.UMwtw<- resid(model.UMwtw.best)
pred.model.UMwtw<- predict(model.UMwtw.best)

# check randomness
plot(pred.model.UMwtw, resid.model.UMwtw, ylab="Residuals", xlab="UM wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwtw, main="Histogram of Residuals", xlab="UM wt")

qqnorm(resid.model.UMwtw)

# Shapiro-Wilk test
shapiro.test(resid.model.UMwtw)

# possible outlier
hist(Hdatw$UM_wt)
## hard-removing outlier as quick fix, saving under different dataframe
max(Hdatw$UM_wt, na.rm=T)
UMoutlier.rm<- Hdatw[-c(grep("6356", Hdatw$UM_wt)),]
# check that data point doesn't exist in new dataset
grep("6356", UMoutlier.rm$UM_wt)

# analysis again w/o outlier
model.UMwtw2<- lmer(UM_wt ~ Weediness * Cult * SR + (1 | Year / Rep), data=UMoutlier.rm)
summary(model.UMwtw2)
anova(model.UMwtw2)

model.UMwtw.best2<- get_model(lmerTest::step(model.UMwtw2, reduce.random=F))
summary(model.UMwtw.best2)
anova(model.UMwtw.best2)

# check residuals
resid.model.UMwtw2<- resid(model.UMwtw.best2)
pred.model.UMwtw2<- predict(model.UMwtw.best2)

# check randomness
plot(pred.model.UMwtw2, resid.model.UMwtw2, ylab="Residuals", xlab="UM wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwtw2, main="Histogram of Residuals", xlab="UM wt")

qqnorm(resid.model.UMwtw2)

# Shapiro-Wilk test
shapiro.test(resid.model.UMwtw2)
# assumptions fine w/o outlier

# no main effects to compare means

# no effect of weediness
```
*Best Model:*
UM_wt ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Bad -- outlier -- removed = better

*Means:*
None


```{r UM corn wt analysis -- w vs wf trts, E & S 600}
# test effect of w/wf trt -> Harrow & StJean E & S, 600
model.UMwtw600<- lmer(UM_wt ~ Weediness * Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datw1)
summary(model.UMwtw600)
anova(model.UMwtw600)

model.UMwtw600.best<- get_model(lmerTest::step(model.UMwtw600, reduce.random=F))
summary(model.UMwtw600.best)
anova(model.UMwtw600.best)

# check residuals
resid.model.UMwtw600<- resid(model.UMwtw600.best)
pred.model.UMwtw600<- predict(model.UMwtw600.best)

# check randomness
plot(pred.model.UMwtw600, resid.model.UMwtw600, ylab="Residuals", xlab="UM wt", main="Predictecd vs Residuals") 

# check normality
hist(resid.model.UMwtw600, main="Histogram of Residuals", xlab="UM wt")

qqnorm(resid.model.UMwtw600)

# Shapiro-Wilk test
shapiro.test(resid.model.UMwtw600)

# means
UMwtw600emmeans<- emmeans(model.UMwtw600.best, pairwise ~ Weediness)
UMwtw600emmeans
plot(UMwtw600emmeans, comparisons=T) 

# WF > W
```
*Best Model:*
UM_wt ~ Weediness + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
           Sum Sq Mean Sq NumDF  DenDF F value  Pr(>F)  
Weediness 1749156 1749156     1 37.739   4.988 0.03153 *

*Assumptions:*
fine but not a lot of data

*Means:*
 Weediness emmean  SE   df lower.CL upper.CL
 W           1913 705 1.03    -6448    10275
 WF          2295 705 1.03    -6066    10657
 
*Contrasts:*
 contrast estimate  SE   df t.ratio p.value
 W - WF       -382 171 35.9 -2.233  0.0318 *


```{r UM corn wt analysis -- w vs wf trts, S 600}
# test effect of w/wf trt -> S, 600
model.UMwtws<- lmer(UM_wt ~ Weediness + (1 | Year / Rep) + (1 | Location / Rep), data=datw2)
summary(model.UMwtws)
anova(model.UMwtws)

model.UMwtws.best<- get_model(lmerTest::step(model.UMwtws, reduce.random=F))
summary(model.UMwtws.best)
anova(model.UMwtws.best)

# check residuals
resid.model.UMwtws<- resid(model.UMwtws.best)
pred.model.UMwtws<- predict(model.UMwtws.best)

# check randomness
plot(pred.model.UMwtws, resid.model.UMwtws, ylab="Residuals", xlab="UM wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwtws, main="Histogram of Residuals", xlab="UM wt")

qqnorm(resid.model.UMwtws)

# Shapiro-Wilk test
shapiro.test(resid.model.UMwtws)

# no main effects to compare means

# no effect of weediness
```
*Best Model:*
UM_wt ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
bad hist of resids -- not enough data

*Means:*
None
 
 
```{r UM corn wt analysis -- wf trt vs ctrl, E & S all SR}
# test effect of trts
model.UMwtwf<- lmer(UM_wt ~ Trt_code + (1 | Year / Rep), data=Hdatwf)
summary(model.UMwtwf)
anova(model.UMwtwf)

model.UMwtwf.best<- get_model(lmerTest::step(model.UMwtwf, reduce.random=F))
summary(model.UMwtwf.best)
anova(model.UMwtwf.best)

# check residuals
resid.model.UMwtwf<- resid(model.UMwtwf.best)
pred.model.UMwtwf<- predict(model.UMwtwf.best)

# check randomness
plot(pred.model.UMwtwf, resid.model.UMwtwf, ylab="Residuals", xlab="Um wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwtwf, main="Histogram of Residuals", xlab="Um wt")

qqnorm(resid.model.UMwtwf) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwtwf)

# no main effects
```
*Best Model:*
UM_wt ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Fine except outlier

*Means:*
None
 

```{r UM corn wt analysis -- wf trt vs ctrl, E & S 600}
# test effect of trts
model.UMwt600wf<- lmer(UM_wt ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf1)
summary(model.UMwt600wf)
anova(model.UMwt600wf)

model.UMwt600wf.best<- get_model(lmerTest::step(model.UMwt600wf, reduce.random=F))
summary(model.UMwt600wf.best)
anova(model.UMwt600wf.best)

# check residuals
resid.model.UMwt600wf<- resid(model.UMwt600wf.best)
pred.model.UMwt600wf<- predict(model.UMwt600wf.best)

# check randomness
plot(pred.model.UMwt600wf, resid.model.UMwt600wf, ylab="Residuals", xlab="Um wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwt600wf, main="Histogram of Residuals", xlab="UM wt")

qqnorm(resid.model.UMwt600wf) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwt600wf)

# means
```
*Best Model:*
UM_wt ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Fine except outlier

*Means:*
None
 

```{r UM corn wt analysis -- wf trt vs ctrl, S 600}
# test effect of trts
model.UMwtswf<- lmer(UM_wt ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=datwf2)
summary(model.UMwtswf)
anova(model.UMwtswf)

model.UMwtswf.best<- get_model(lmerTest::step(model.UMwtswf, reduce.random=F))
summary(model.UMwtswf.best)
anova(model.UMwtswf.best)

# check residuals
resid.model.UMwtswf<- resid(model.UMwtswf.best)
pred.model.UMwtswf<- predict(model.UMwtswf.best)

# check randomness
plot(pred.model.UMwtswf, resid.model.UMwtswf, ylab="Residuals", xlab="UM wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwtswf, main="Histogram of Residuals", xlab="UM wt")

qqnorm(resid.model.UMwtswf) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwtswf)

# means
```
*Best Model:*
UM_wt ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not enough data

*Means:*
None
 
 
```{r UM corn wt analysis -- wf trts, E & S all SR}
# test effect of trts
model.UMwtwftrt<- lmer(UM_wt ~ Cult * SR + (1 | Year / Rep), data=Hdatwftrt)
summary(model.UMwtwftrt)
anova(model.UMwtwftrt)

model.UMwtwftrt.best<- get_model(lmerTest::step(model.UMwtwftrt, reduce.random=F))
summary(model.UMwtwftrt.best)
anova(model.UMwtwftrt.best)

# check residuals
resid.model.UMwtwftrt<- resid(model.UMwtwftrt.best)
pred.model.UMwtwftrt<- predict(model.UMwtwftrt.best)

# check randomness
plot(pred.model.UMwtwftrt, resid.model.UMwtwftrt, ylab="Residuals", xlab="UM wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwtwftrt, main="Histogram of Residuals", xlab="UM wt")

qqnorm(resid.model.UMwtwftrt) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwtwftrt)

# no main effects
```
*Best Model:*
UM_wt ~ (1 | Year/Rep)

*Effects:*


*Assumptions:*
Fine except outlier

*Means:*
None
 
 
```{r UM corn wt analysis -- wf trts, E & S 600}
# test effect of trts
model.UMwtwftrt600<- lmer(UM_wt ~ Cult + (1 | Year / Rep) + (1 | Location / Rep), data=datwftrt1)
summary(model.UMwtwftrt600)
anova(model.UMwtwftrt600)

model.UMwtwftrt600.best<- get_model(lmerTest::step(model.UMwtwftrt600, reduce.random=F))
summary(model.UMwtwftrt600.best)
anova(model.UMwtwftrt600.best)

# check residuals
resid.model.UMwtwftrt600<- resid(model.UMwtwftrt600.best)
pred.model.UMwtwftrt600<- predict(model.UMwtwftrt600.best)

# check randomness
plot(pred.model.UMwtwftrt600, resid.model.UMwtwftrt600, ylab="Residuals", xlab="UM wt", main="Predictecd vs Residuals")

# check normality
hist(resid.model.UMwtwftrt600, main="Histogram of Residuals", xlab="UM wt")

qqnorm(resid.model.UMwtwftrt600) 

# Shapiro-Wilk test
shapiro.test(resid.model.UMwtwftrt600)

# no main effects
```
*Best Model:*
UM_wt ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Not great -- not enough data

*Means:*
None
 


### Weeds

#### Counts

```{r weed count tables}
# table with sums of weed counts & standard deviation for within each combination of year, location, cultivar, seeding rate, and time 
Wtable<-wdat %>%
  group_by(Year, Location, Cult, SR, Time) %>%
  summarize(Sum=sum(Count), SD=sd(Count))

Wtable$Time<- factor(Wtable$Time, levels = c("PRE","28DAT","56DAT")) # reorder Time levels so chronological
```


```{r weed count analysis -- graphs}
# plot sum of weed counts & SD from table against seeding rate, factored by cultivar (shape) & time (colour), facted by location & year
## dodged position for easier reading
Wplot<- ggplot(Wtable, aes(x=SR, y=Sum, colour=factor(Time), shape=factor(Cult))) +
  geom_point(position=position_dodge(0.9), size=3) +
  geom_errorbar(aes(ymin=Sum-SD, ymax=Sum+SD), width=0.2, position=position_dodge(0.9)) +
  facet_wrap(Location~Year) +
  theme_bw()
print(Wplot)

# plot of weed count over time (Pre, 28DAT, 56DAT), factored by Cultivar (point shape) & seeding rate (colour & lines), faceted by location & year
Wplot2<- ggplot(Wtable, aes(x=Time, y=Sum, colour=factor(SR), shape=factor(Cult), group=interaction(SR, Cult))) +
  geom_point(size=3) +
  geom_line() +
  geom_errorbar(aes(ymin=Sum-SD, ymax=Sum+SD), width=0.2) +
  facet_wrap(Location~Year) +
  theme_bw()
print(Wplot2)
```


```{r weed count analysis -- models}
# weed count models
## count data so glmer used with poisson distribution
### since repeated measures, plot added as random effect (not nested or cross classified)

# lmer
model.weedcount<- lmer(Count ~ Cult * SR * Time + (1 | Year / Rep) + (1 | Location / Rep) + (1 | Plot), data=wdat)
summary(model.weedcount)
Anova(model.weedcount, type="III")

# glmer
model.weedcount2<- glmer(Count ~ Cult * SR * Time + (1 | Year / Rep) + (1 | Location / Rep) + (1 | Plot), data=wdat, family=poisson)
Anova(model.weedcount2, type="III")

# check residuals
resid.model.wcount<- resid(model.weedcount)
pred.model.wcount<- predict(model.weedcount)

# check randomness
plot(pred.model.wcount, resid.model.wcount, ylab="Residuals", xlab="Weed counts", main="Predictecd vs Residuals")
# weird trend

# check normality
hist(resid.model.wcount, main="Histogram of Residuals", xlab="weed counts")
# long tails on right

qqnorm(resid.model.wcount) # curvy shape

# Shapiro-Wilk test
shapiro.test(resid.model.wcount)
# assumptions not met, needs transformations? Or not using right format of data?
```
-> need to decide whether to use glmer or lmer -- diff results or either 


#### Biomass

```{r weed biomass tables}
# table with sums of weed biomass for each combination of year, location, cultivar, seeding rate, & plot
WWsumtable<- subset(wdat, Time=="56DAT") %>%
  group_by(Year, Location, Cult, SR, Plot) %>%
  summarize(WSum=sum(Weight))
# table with mean weed biomass & standard deviation for each combination of year, location, cultivar, & seeding rate (i.e. averaged across reps)
WWmeantable<- WWsumtable %>%
  group_by(Year, Location, Cult, SR) %>%
  summarize(WMean=mean(WSum), WSD=sd(WSum))

WWmeantable$Cult<- factor(WWmeantable$Cult, levels = c("Standard", "Early", "NoRye")) # reorder cultivar levels

WWtable<-subset(wdat, Time=="56DAT") %>%
  group_by(Year, Location, Cult, SR, Plot, Rep, Trt_num) %>%
  summarize(W=sum(Weight), Wsd=sd(Weight))
```

```{r weed biomass analysis -- graphs, error=T}
wplot<- ggplot(WWtable, aes(x = SR, y = W, fill = Cult)) + 
          geom_boxplot() +
          theme_bw()
print(wplot)

wplot<- ggplot(WWtable, aes(x = SR, y = W, fill = Cult)) + 
          geom_boxplot() +
          facet_wrap(Year~Location) +
          theme_bw()
print(wplot)

# plot weed biomass & SD from table of means by cultivar & seeding rate, facetted by location & year
## added in group=interaction(SR, Cult) as suggested from plotly.com/ggplot2/geom_line/
### dodged position used for legibility
WWplot<- ggplot(WWmeantable, aes(x=Cult, y=WMean, colour=factor(SR), group=interaction(SR, Cult))) +
  geom_point(position=position_dodge(0.9), size=3) +
  geom_errorbar(aes(ymin=WMean-WSD, ymax=WMean+WSD), width=0.2, position=position_dodge(0.9)) +
  facet_wrap(Location~Year) + 
  theme_bw()
print(WWplot)
```

```{r weed biomass analysis -- trts vs ctrl}
model.ww<- lmer(Weight ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=subset(wdat, Time=="56DAT"))
summary(model.ww)
anova(model.ww)

model.ww.best<- get_model(lmerTest::step(model.ww, reduce.random=F))
summary(model.ww.best)
anova(model.ww.best)

# check residuals
resid.model.ww<- resid(model.ww.best)
pred.model.ww<- predict(model.ww.best)

# check randomness
plot(pred.model.ww, resid.model.ww, ylab="Residuals", xlab="Weed wt", main="Predictecd vs Residuals")
# weird trend

# check normality
hist(resid.model.ww, main="Histogram of Residuals", xlab="weed wt")
# long tails on right

qqnorm(resid.model.ww) # curvy shape

# Shapiro-Wilk test
shapiro.test(resid.model.ww)

# adjust for skewedness -- sqrt
model.ww2<- lmer(sqrt(Weight) ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=subset(wdat, Time=="56DAT"))
summary(model.ww)
anova(model.ww)

model.ww.best2<- get_model(lmerTest::step(model.ww2, reduce.random=F))
summary(model.ww.best2)
anova(model.ww.best2)

# check residuals
resid.model.ww2<- resid(model.ww.best2)
pred.model.ww2<- predict(model.ww.best2)

# check randomness
plot(pred.model.ww2, resid.model.ww2, ylab="Residuals", xlab="Weed wt", main="Predictecd vs Residuals")
# weird trend

# check normality
hist(resid.model.ww2, main="Histogram of Residuals", xlab="weed wt")
# long tails on right

qqnorm(resid.model.ww2) # curvy shape

# Shapiro-Wilk test
shapiro.test(resid.model.ww2)

# still skewed, try cube root
model.ww3<- lmer((Weight)^1/3 ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=subset(wdat, Time=="56DAT"))
summary(model.ww3)
anova(model.ww3)

model.ww.best3<- get_model(lmerTest::step(model.ww3, reduce.random=F))
summary(model.ww.best3)
anova(model.ww.best3)

# check residuals
resid.model.ww3<- resid(model.ww.best3)
pred.model.ww3<- predict(model.ww.best3)

# check randomness
plot(pred.model.ww3, resid.model.ww3, ylab="Residuals", xlab="Weed wt", main="Predictecd vs Residuals")
# weird trend

# check normality
hist(resid.model.ww3, main="Histogram of Residuals", xlab="weed wt")
# long tails on right

qqnorm(resid.model.ww3) # curvy shape

# Shapiro-Wilk test
shapiro.test(resid.model.ww3)

# worse... try log
model.ww4<- lmer(log(Weight+1) ~ Trt_code + (1 | Year / Rep) + (1 | Location / Rep), data=subset(wdat, Time=="56DAT"))
summary(model.ww4)
anova(model.ww4)

model.ww.best4<- get_model(lmerTest::step(model.ww4, reduce.random=F))
summary(model.ww.best4)
anova(model.ww.best4)

# check residuals
resid.model.ww4<- resid(model.ww.best4)
pred.model.ww4<- predict(model.ww.best4)

# check randomness
plot(pred.model.ww4, resid.model.ww4, ylab="Residuals", xlab="Weed wt", main="Predictecd vs Residuals")
# weird trend

# check normality
hist(resid.model.ww4, main="Histogram of Residuals", xlab="weed wt")
# long tails on right

qqnorm(resid.model.ww4) # curvy shape

# Shapiro-Wilk test
shapiro.test(resid.model.ww4)
# better but not great

# means
wwemmeans<- emmeans(model.ww.best4, pairwise ~ Trt_code)
wwemmeans
plot(wwemmeans, comparisons=T)
```
*Best Model:*
log(Weight + 1) ~ Trt_code + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
         Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    
Trt_code 69.829  8.7286     8 1081.3  5.9652 1.654e-07 ***

*Assumptions:*
Right skewed --> adjusted w/ log --> better but still not great

*Means:*
 Trt_code emmean    SE   df lower.CL upper.CL
 E1W1N      1.88 0.574 2.10  -0.4769     4.24
 E2W1N      1.79 0.574 2.11  -0.5614     4.14
 E3W1N      1.79 0.575 2.13  -0.5496     4.13
 S1W1N      1.81 0.572 2.09  -0.5480     4.17
 S2W1N      1.56 0.572 2.10  -0.7921     3.92
 S3W1N      1.50 0.574 2.12  -0.8394     3.84
 S3WF1N     1.19 0.656 3.54  -0.7264     3.11
 W1N        2.28 0.572 2.09  -0.0773     4.64
 WF1N       1.29 0.662 3.68  -0.6159     3.19
 
*Comparisons:*
 contrast       estimate    SE   df t.ratio p.value
 E1W1N - E2W1N   0.09268 0.141 1078  0.659  0.9992 
 E1W1N - E3W1N   0.09063 0.144 1079  0.630  0.9994 
 E1W1N - S1W1N   0.06936 0.136 1043  0.509  0.9999 
 E1W1N - S2W1N   0.31513 0.136 1064  2.311  0.3365 
 E1W1N - S3W1N   0.37862 0.143 1061  2.641  0.1711 
 E1W1N - S3WF1N  0.68795 0.357  401  1.925  0.5970 
 E1W1N - W1N    -0.40336 0.136 1025 -2.960  0.0764 
 E1W1N - WF1N    0.59181 0.369  436  1.604  0.8024 
 E2W1N - E3W1N  -0.00205 0.147 1079 -0.014  1.0000 
 E2W1N - S1W1N  -0.02332 0.139 1053 -0.168  1.0000 
 E2W1N - S2W1N   0.22246 0.139 1076  1.596  0.8072 
 E2W1N - S3W1N   0.28594 0.146 1067  1.961  0.5709 
 E2W1N - S3WF1N  0.59527 0.358  409  1.662  0.7692 
 E2W1N - W1N    -0.49604 0.139 1035 -3.573  0.0111 *
 E2W1N - WF1N    0.49913 0.370  443  1.351  0.9152 
 E3W1N - S1W1N  -0.02127 0.142 1064 -0.149  1.0000 
 E3W1N - S2W1N   0.22451 0.143 1080  1.575  0.8183 
 E3W1N - S3W1N   0.28799 0.149 1075  1.931  0.5925 
 E3W1N - S3WF1N  0.59733 0.359  423  1.665  0.7676 
 E3W1N - W1N    -0.49399 0.142 1054 -3.468  0.0159 *
 E3W1N - WF1N    0.50118 0.370  457  1.354  0.9142 
 S1W1N - S2W1N   0.24578 0.133 1082  1.854  0.6455 
 S1W1N - S3W1N   0.30926 0.140 1082  2.216  0.3960 
 S1W1N - S3WF1N  0.61860 0.350  592  1.767  0.7041 
 S1W1N - W1N    -0.47272 0.132 1081 -3.579  0.0108 *
 S1W1N - WF1N    0.52245 0.362  629  1.442  0.8809 
 S2W1N - S3W1N   0.06349 0.140 1082  0.452  1.0000 
 S2W1N - S3WF1N  0.37282 0.352  534  1.060  0.9794 
 S2W1N - W1N    -0.71850 0.133 1082 -5.406  <.0001 *
 S2W1N - WF1N    0.27667 0.363  571  0.761  0.9978 
 S3W1N - S3WF1N  0.30933 0.354  576  0.873  0.9942 
 S3W1N - W1N    -0.78198 0.139 1080 -5.613  <.0001 *
 S3W1N - WF1N    0.21319 0.366  612  0.582  0.9997 
 S3WF1N - W1N   -1.09132 0.351  612 -3.110  0.0504 
 S3WF1N - WF1N  -0.09615 0.467 1078 -0.206  1.0000 
 W1N - WF1N      0.99517 0.363  647  2.745  0.1343


```{r weed biomass analysis -- trts}
model.wwtrt<- lmer(Weight ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=subset(wdattrt, Time=="56DAT"))
summary(model.wwtrt)
anova(model.wwtrt)

model.wwtrt.best<- get_model(lmerTest::step(model.wwtrt, reduce.random=F))
summary(model.wwtrt.best)
anova(model.wwtrt.best)

# check residuals
resid.model.wwtrt<- resid(model.wwtrt.best)
pred.model.wwtrt<- predict(model.wwtrt.best)

# check randomness
plot(pred.model.wwtrt, resid.model.wwtrt, ylab="Residuals", xlab="Weed wt", main="Predictecd vs Residuals")
# weird trend

# check normality
hist(resid.model.wwtrt, main="Histogram of Residuals", xlab="weed wt")
# long tails on right

qqnorm(resid.model.wwtrt) # curvy shape

# Shapiro-Wilk test
shapiro.test(resid.model.wwtrt)
# assumptions not met

# adjust for right skewness -- log transform
model.wwtrt2<- lmer(log(Weight+1) ~ Cult * SR + (1 | Year / Rep) + (1 | Location / Rep), data=subset(wdattrt, Time=="56DAT"))
summary(model.wwtrt2)
anova(model.wwtrt2)

model.wwtrt.best2<- get_model(lmerTest::step(model.wwtrt2, reduce.random=F))
summary(model.wwtrt.best2)
anova(model.wwtrt.best2)

# check residuals
resid.model.wwtrt2<- resid(model.wwtrt.best2)
pred.model.wwtrt2<- predict(model.wwtrt.best2)

# check randomness
plot(pred.model.wwtrt2, resid.model.wwtrt2, ylab="Residuals", xlab="Weed wt", main="Predictecd vs Residuals")
# weird trend

# check normality
hist(resid.model.wwtrt2, main="Histogram of Residuals", xlab="weed wt")
# long tails on right

qqnorm(resid.model.wwtrt2) # curvy shape

# Shapiro-Wilk test
shapiro.test(resid.model.wwtrt2)
# better but still not great

# means
wwtrtemmeans1<- emmeans(model.wwtrt.best2, pairwise ~ Cult, type="response")
wwtrtemmeans1

wwtrtemmeans2<- emmeans(model.wwtrt.best2, pairwise ~ SR, type="response")
wwtrtemmeans2
```
*Best Model:*
log(Weight + 1) ~ Cult + SR + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
     Sum Sq Mean Sq NumDF  DenDF F value  Pr(>F)  
Cult 7.3316  7.3316     1 807.07  5.4127 0.02024 *
SR   8.3631  4.1816     2 903.10  3.0871 0.04611 *

*Assumptions:*
Not met --> log transformed --> better but not great

*Means:*
 Cult     response   SE   df lower.CL upper.CL
 Early        5.22 3.82 2.02   -0.547     84.3
 Standard     4.20 3.18 2.02   -0.621     70.1
 
  SR  response   SE   df lower.CL upper.CL
 150     5.48 3.98 2.03   -0.522     86.8
 300     4.45 3.35 2.03   -0.597     72.7
 600     4.20 3.19 2.04   -0.614     68.9

*Contrasts:*
 contrast         ratio     SE  df t.ratio p.value
 Early / Standard   1.2 0.0957 635 2.251   0.0247 *
 
  contrast  ratio    SE  df t.ratio p.value
 150 / 300  1.19 0.110 903 1.865   0.1497 
 150 / 600  1.25 0.119 906 2.321   0.0535 *
 300 / 600  1.05 0.101 905 0.499   0.8718 





### Correlation of rye biomass & weed biomass

```{r}
# need dataframe with rye biomass & weed biomass data
WWmeantable # table of Year, Location, Cultivar, Seeding rate, Mean weed biomass (across all reps), standard deviation of the mean

# make table of Mean rye biomass (across all reps) for each Year, Location, Cultivar, Seeding rate, + standard deviation of the mean
RWsumtable<- dat %>%
  group_by(Year, Location, Cult, SR, Plot) %>%
  summarize(RSum=sum(Rye_wt))

RWmeantable<- RWsumtable %>%
  group_by(Year, Location, Cult, SR) %>%
  summarize(RMean=mean(RSum, na.rm=T), RSD=sd(RSum, na.rm=T))

# combine the two tables
RWWtable<- merge(WWmeantable, RWmeantable, by=c("Year", "Location","Cult","SR"))
print(RWWtable)

RWWtable2<- merge(WWsumtable, RWsumtable, by=c("Year","Location","Cult","SR","Plot"))

# correlate rye biomass & weed biomass
RWWplot1<- ggplot(RWWtable, aes(x = RMean, y = WMean, colour=interaction(SR,Cult))) +
  geom_point(size=3) +
  geom_errorbar(aes(ymin=WMean-WSD, ymax=WMean+WSD)) +
  geom_errorbarh(aes(xmin=RMean-RSD, xmax=RMean+RSD)) +
  facet_wrap(Location~Year) +
  theme_bw()
print(RWWplot1)

RWWplot2<- ggplot(RWWtable2, aes(x = RSum, y = WSum, colour=interaction(SR,Cult))) +
  geom_point(size=3) +
  facet_wrap(Location~Year) +
  theme_bw()
print(RWWplot2)

RWWplot3<- ggplot(RWWtable2, aes(x = RSum, y = WSum, colour=factor(SR))) +
  geom_point(size=3) +
  facet_wrap(Location~Year) +
  theme_bw()
print(RWWplot3)

RWWplot4<- ggplot(RWWtable2, aes(x = RSum, y = WSum, colour=factor(Cult))) +
  geom_point(size=3) +
  facet_wrap(Location~Year) +
  theme_bw()
print(RWWplot4)

ggscatter(RWWtable2, x = "RSum", y = "WSum", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Rye biomass", ylab = "Weed biomass") +
  facet_wrap(Location~Year)
# significant negative correlation when data pooled but not consistent amongst years & locations

cor.test(RWWtable2$RSum, RWWtable2$WSum, method="pearson")
# can I use cor.test to test correlation for each location & year?

```


### Correlation of corn biomass & weed biomass

```{r}
ggscatter(dat, x = "Rye_wt", y = "M_wt", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Rye biomass", ylab = "Marketable corn biomass") +
  facet_wrap(Location~Year)

ggscatter(dat, x = "Rye_wt", y = "M_wt", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Rye biomass", ylab = "Marketable corn biomass")

cor.test(dat$Rye_wt, dat$M_wt, method="pearson")
# not a significant correlation between corn biomass & rye biomas

MWsumtable<- dat %>%
  group_by(Year, Location, Cult, SR, Plot) %>%
  summarize(MSum=sum(M_wt))

MWWsumtable<- merge(MWsumtable, WWsumtable, by=c("Year","Location","Cult","SR","Plot"))

ggscatter(MWWsumtable, x = "WSum", y = "MSum", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Weed biomass", ylab = "Marketable corn biomass") +
  facet_wrap(Location~Year)
# Harrow 2020 has nice negative relationship

ggscatter(MWWsumtable, x = "WSum", y = "MSum", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Weed biomass", ylab = "Marketable corn biomass")

cor.test(MWWsumtable$WSum, MWWsumtable$MSum, method="pearson")
# not a significant correlation between corn biomass & weed biomass

# correlation between weed biomass & corn biomass, HARROW 2020
ggscatter(subset(MWWsumtable, Location=="Harrow" & Year == "2020"), x = "WSum", y = "MSum", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Weed biomass", ylab = "Marketable corn biomass")

# correlation between weed biomass & corn biomass, AGASSIZ 2019
ggscatter(subset(MWWsumtable, Location=="Agassiz" & Year == "2019"), x = "WSum", y = "MSum", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Weed biomass", ylab = "Marketable corn biomass")

SJtest<- subset(MWWsumtable, Location=="StJean")
cor.test(SJtest$WSum, SJtest$MSum, method="pearson")
```


### Corn biomass by seeding rate

```{r}
Mtable<- dat %>%
  group_by(Year, Location, SR, Weediness) %>%
  summarize(MwtMean=mean(M_wt), MwtSD=sd(M_wt))

ggplot(Mtable, aes(x=SR, y=MwtMean, colour=factor(Weediness))) + 
  geom_point(size=3, position=position_dodge(0.9)) +
  geom_errorbar(aes(ymin=MwtMean-MwtSD, ymax=MwtMean+MwtSD), position=position_dodge(0.9)) +
  facet_wrap(Year~Location) +
  theme_bw()

```


#DIR

## load datasets 

There are two datasets for this analysis -- one containing rye stand & weight, corn injury & yield, etc, & the other containing weed counts, stages, & weights

```{r dir data, results='hide', message=FALSE, warning=FALSE}
# first dataset containing rye & corn data
dir<- read.csv("DIR_Long.csv")
str(dir)
dir$Plot<- as.factor(dir$Plot)
dir$Rep<- as.factor(dir$Rep)
dir$Trt_num<- as.factor(dir$Trt_num)

dirtrt<- subset(dir, !is.na(dir$Trt_plnt)) # dirtrt contains only trt plots (no ctrls)

dirmain<- subset(dir, Weediness=="W") # removing subplot trt (Weediness)
dirmaintrt<- subset(dirmain, !is.na(dirmain$Trt_plnt)) # dirmaintrt contains only main plot effects for trts
```

```{r dir weeds data}
# second dataset containing weeds data
dirw<- read.csv("DIR_Weeds.csv")
dirw$Rep<- as.factor(dirw$Rep)
dirw$Trt_num<- as.factor(dirw$Trt_num)
```

```{r load packages}
# load packages
library(ggplot2, quietly = TRUE)
library(dplyr, quietly = TRUE)
library(car, quietly = TRUE)
library(lme4, quietly = TRUE)
library(lmerTest, quietly = TRUE)
library(ggpubr, quietly = TRUE)
library(lsmeans, quietly = TRUE)
library(emmeans, quietly = TRUE)
library(rstatix, quietly = TRUE)
library(cAIC4, quietly = TRUE)
```

## analysis

For each variable, a graph was created plotting the variable against rye planting direction & crimping direction (if applicable). This was to get a general sense of the trends in the data & look for any anomalies or potential errors.

From there, a full model was created with rye planting and crimping direction as fixed effects, and rep as a random effect to test whether the treatments were different from the control.

Then, the control was dropped and the model ran again to test the differences between treatments. 

The full model was reduced using the function `lmerTest::step()` which applies a backward model reduction approach using the Satterthwaite degrees of freedom method. This function does **not** work on `glmer()` so those required manual reduction.

The simplified model was resaved as `model.x.best`.

A summary table and anova table of the best model was produced to obtain p-values for each fixed effect. 

Model assumptions were tested using a Shapiro-Wilk Test and by visual inspection of the following diagnostic plots of residuals: Predicted vs Actual Residuals, Histogram of Residuals, and Q-Q Plot. 

If model assumptions were not well met, a note has been added and I will further investigate whether a transformation is needed.

If model assumptions were met, a final graph of the variable plotted with only the significant factors was produced. 

Statistical design is an RCBD with planting & crimping as factorial & weediness as split plot factor. The model is:

Y = $\mu$ + block + trt_plnt + trt_crmp + trt_plnt x trt_crmp + weediness + trt_plnt x trt_crmp x weediness + e


### rye stand

```{r rye stand data modifications, results='hide', message=FALSE, warning=FALSE}
# remove no rye control plots
dirtrt<- subset(dir, Trt_plnt=="E"|Trt_plnt=="N")
# create column with total rye stand
dir$Rye_total_stand<- dir$Rye_back_stand + dir$Rye_front_stand
```

```{r plot rye stand}
# front
ryestandfront<- ggplot(dirtrt, aes(x = Trt_plnt, y = Rye_front_stand)) +
          geom_boxplot() +
          theme_bw()
print(ryestandfront)

# back
ryestandback<- ggplot(dirtrt, aes(x = Trt_plnt, y = Rye_back_stand)) +
          geom_boxplot() +
          theme_bw()
print(ryestandback)

# total
ryestandtotal<- ggplot(dirtrt, aes(x = Trt_plnt, y = (Rye_front_stand+Rye_back_stand))) + 
          geom_boxplot() +
          theme_bw()
print(ryestandtotal)
```

```{r t test rye stand (front vs back)}
# paired sample t test to determine if front stand different from back stand
standtest<- t.test(dir$Rye_front_stand, dir$Rye_back_stand, paired = T)
standtest
# not significantly different so pool
```

```{r plot rye stand rep effect, results='hide', message=FALSE, warning=FALSE}
# front
ryestandfrontrep<- ggplot(dirtrt, aes(x = Rep, y = Rye_front_stand)) +
          geom_boxplot() +
          theme_bw()
print(ryestandfrontrep)

# back
ryestandbackrep<- ggplot(dirtrt, aes(x = Rep, y = Rye_back_stand)) +
          geom_boxplot() +
          theme_bw()
print(ryestandbackrep)

# total
ryestandtotalrep<- ggplot(dirtrt, aes(x = Rep, y = (Rye_front_stand+Rye_back_stand))) +
          geom_boxplot() +
          theme_bw()
print(ryestandtotalrep)

# clear rep effect w/ rep 3 being highest, 1 being lowest

# anova of reps to determine if statistically different
standrep<- anova_test(Rye_total_stand ~ Rep, data=dirtrt)
standrep
# significant 
```

```{r model rye stand, results='hide', message=FALSE, warning=FALSE}
# total
model.stand<- lmer((Rye_front_stand+Rye_back_stand) ~ Trt_plnt + ( 1 | Rep), data=dirtrt)
summary(model.stand)
anova(model.stand)

## model reduction
model.stand.best<- get_model(lmerTest::step(model.stand, reduce.random=F))
summary(model.stand.best)
anova(model.stand.best)
### best model: (Rye_front_stand + Rye_back_stand) ~ (1 | Rep)
```

```{r rye stand model assumptions, results='hide', message=FALSE, warning=FALSE,}
# check residuals
resid.model.stand<- resid(model.stand.best)
pred.model.stand<- predict(model.stand.best)

# check randomness
plot(pred.model.stand, resid.model.stand, ylab="Residuals", xlab="Rye Stand", main="Predictecd vs Residuals")

# check normality
hist(resid.model.stand, main="Histogram of Residuals", xlab="Rye Stand") # a little disrupted

qqnorm(resid.model.stand) 

# Shapiro-Wilk test
shapiro.test(resid.model.stand)
# test assumptions fine
```

```{r rye stand difference of means, results='hide', message=FALSE, warning=FALSE,}
# no signficant main effects to compare means
```


### rye biomass

```{r plot rye biomass}
ryewt<- ggplot(dirtrt, aes(x = Trt_plnt, y = Rye_wt)) + 
          geom_boxplot() +
          theme_bw()
print(ryewt)
```

```{r plot rye biomass rep effect}
ryewtrep<- ggplot(dirmaintrt, aes(x = Rep, y = Rye_wt)) +
          geom_boxplot() +
          theme_bw()
print(ryewtrep)

# clear rep effect w/ rep 3 being highest, 1 being lowest (similar to stand)

# anova of reps to determine if statistically different
ryewtrep<- anova_test(Rye_wt ~ Rep, data=dirmaintrt)
ryewtrep
# not significant
```

```{r model rye biomass}
model.ryewt<- lmer(Rye_wt ~ Trt_plnt + ( 1 | Year/Rep) + (1 | Location/Rep), data=dirmaintrt)
summary(model.ryewt)
anova(model.ryewt)

# model reduction
model.ryewt.best<- get_model(lmerTest::step(model.ryewt, reduce.random=F))
summary(model.ryewt.best)
anova(model.ryewt.best)
```

```{r rye biomass model assumptions}
# check residuals
resid.model.ryewt<- resid(model.ryewt.best)
pred.model.ryewt<- predict(model.ryewt.best)

# check randomness
plot(pred.model.ryewt, resid.model.ryewt, ylab="Residuals", xlab="Rye biomass", main="Predictecd vs Residuals") # some divide

# check normality
hist(resid.model.ryewt, main="Histogram of Residuals", xlab="Rye biomass") 

qqnorm(resid.model.ryewt) 

# Shapiro-Wilk test
shapiro.test(resid.model.ryewt)
# test assumptions fine
```

```{r rye biomass difference of means}
# no signficant main effects to compare means
```
*Best Model:*
Rye_wt ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Fine, slightly right skewed -> outlier?

*Means:*


### rye pop ups

```{r pop up data modifications, results='hide', message=FALSE, warning=FALSE}
# use dirtrt
# convert pop  up data to long form
dirpop <- dirtrt %>%
  gather(key = "time", value = "popups", Pop_0DAT,Pop_7DAT,Pop_14DAt,Pop_21DAT,Pop_28DAT) %>%
  convert_as_factor(Plot, time)
```

```{r plot rye pop ups}
ryepop<- ggplot(dirpop, aes(x = time, y = popups)) + 
          geom_boxplot() +
          theme_bw()
print(ryepop)
# little difference over time after first week

ryepop<- ggplot(dirpop, aes(x = time, y = popups, fill=factor(Trt_plnt))) + 
          geom_boxplot() +
          theme_bw()
print(ryepop)
# no differences across planting arrangements

ryepop<- ggplot(dirpop, aes(x = time, y = popups, fill=factor(Trt_crmp))) + 
          geom_boxplot() +
          theme_bw()
print(ryepop)
# slightly better crimp when travelling east, possibly dampens over time

ryepop<- ggplot(dirpop, aes(x = time, y = popups, colour=factor(Trt_plnt), shape=Trt_crmp)) + 
          geom_point(position=position_dodge(0.9)) +
          theme_bw()
print(ryepop)
# appears to  be differences across crimping directions but not planting directions
```

```{r plot rye pop up rep effect, results='hide', message=FALSE, warning=FALSE}
ryepoprep<- ggplot(dirpop, aes(x = Rep, y = popups)) +
          geom_boxplot() +
          theme_bw()
print(ryepoprep)
# no sign of rep effect

# anova of reps to determine if statistically different
ryepoprep<- anova_test(popups ~ Rep, data=dirpop)
ryepoprep
# not significant
```

```{r model rye pop ups, results='hide', message=FALSE, warning=FALSE}
# Note: should PLOT be included as a random effect? i.e. (1 | Rep:Plot) ? saw it in online tutorial: https://m-clark.github.io/docs/mixedModels/anovamixed.html
model.pop<- lmer(popups ~ Trt_plnt*Trt_crmp*time + ( 1 | Rep), data=dirpop)
summary(model.pop)
anova(model.pop)

## model reduction
model.pop.best<- get_model(lmerTest::step(model.pop, reduce.random=F))
summary(model.pop.best)
anova(model.pop.best)
### best model: popups ~ Trt_crmp + time + (1 | Rep)
```

```{r rye pop up model assumptions, results='hide', message=FALSE, warning=FALSE}
# check residuals
resid.model.pop<- resid(model.pop.best)
pred.model.pop<- predict(model.pop.best)

# check randomness
plot(pred.model.pop, resid.model.pop, ylab="Residuals", xlab="Rye pop ups", main="Predictecd vs Residuals")

# check normality
hist(resid.model.pop, main="Histogram of Residuals", xlab="Rye pop  ups") 

qqnorm(resid.model.pop) 

# Shapiro-Wilk test
shapiro.test(resid.model.pop)
# test assumptions not great but acceptable
```

```{r rye pop ups difference of means}
popmean1<- emmeans(model.pop.best, pairwise ~ Trt_crmp)
popmean1
# 34.5 less pop ups in East crimped than North crimped

popmean2<- emmeans(model.pop.best, pairwise ~ time)
popmean2
# pop ups at time 0 different from all other times, all other times not different from each other
```


### rye mortality

```{r mortality data modifications, results='hide', message=FALSE, warning=FALSE}
# use dirtrt
# convert mortality data to long form
dirmort <- dirtrt %>%
  gather(key = "time", value = "mort", Mort_7DAT,Mort_14DAT,Mort_21DAT,Mort_28DAT) %>%
  convert_as_factor(Plot, time)
# arrange mortality time in order
dirmort$time<- factor(dirmort$time, levels = c("Mort_7DAT","Mort_14DAT","Mort_21DAT","Mort_28DAT")) 
```

```{r plot rye mortality}
ryemort<- ggplot(dirmort, aes(x = time, y = mort)) + 
          geom_boxplot() +
          theme_bw()
print(ryemort)

ryemort<- ggplot(dirmort, aes(x = time, y = mort, fill=Trt_plnt)) + 
          geom_boxplot() + 
          theme_bw()
print(ryemort)
# mortality higher in North planted than East planted but dampens by 21DAT

ryemort<- ggplot(dirmort, aes(x = time, y = mort, fill=Trt_crmp)) + 
          geom_boxplot() + 
          theme_bw()
print(ryemort)
# mortality higher in East than North 7DAT, then higher in North than East 14DAT, then even at 21 & 28

ryemort<- ggplot(dirmort, aes(x = time, y = mort, fill=factor(Trt_num))) + 
          geom_boxplot() + 
          theme_bw()
print(ryemort)
# 7DAT: order of decreasing mortality = 3, 4, 5, 6; 14DAT: 4, 5, 6&3
## 3 = NN, 4 = NE, 5 = EN, 6 = EE 
# all the same at 21 & 28DAT
```

```{r plot rye mortality rep effect, results='hide', message=FALSE, warning=FALSE}
ryemortrep<- ggplot(dirmort, aes(x = Rep, y = mort)) +
          geom_boxplot() +
          theme_bw()
print(ryemortrep)

# no apparent rep effect

# anova of reps to determine if statistically different
ryemortrep<- anova_test(mort ~ Rep, data=dirmort)
ryemortrep
# not significant
```

```{r model rye mortality, results='hide', message=FALSE, warning=FALSE}
model.mort<- lmer(mort ~ Trt_plnt*Trt_crmp*time + ( 1 | Rep), data=dirmort)
summary(model.mort)
anova(model.mort)

## model reduction
model.mort.best<- get_model(lmerTest::step(model.mort, reduce.random=F))
summary(model.mort.best)
anova(model.mort.best)
### best model: mort ~ Trt_plnt + time + (1 | Rep)
```

```{r rye mortality model assumptions, results='hide', message=FALSE, warning=FALSE}
# check residuals
resid.model.mort<- resid(model.mort.best)
pred.model.mort<- predict(model.mort.best)

# check randomness
plot(pred.model.mort, resid.model.mort, ylab="Residuals", xlab="Rye mortality", main="Predictecd vs Residuals") # some divide

# check normality
hist(resid.model.mort, main="Histogram of Residuals", xlab="Rye mortality") 

qqnorm(resid.model.mort) 

# Shapiro-Wilk test
shapiro.test(resid.model.mort)
# test assumptions not great
```

```{r rye mortality difference of means}
mortmean1<- emmeans(model.mort.best, pairwise ~ Trt_plnt)
mortmean1
# 4.38% better mortality in North than East planting

mortmean2<- emmeans(model.mort.best, pairwise ~ time)
mortmean2
# increasing mortality over timem, all statistically different from each other
```


### corn stand

```{r plot corn stand}
cstand<- ggplot(dir2, aes(x = weediness, y = stand)) + 
          geom_boxplot() +
          theme_bw()
print(cstand)

cstand<- ggplot(dir2, aes(x = Trt_plnt, y = stand, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(cstand)
# no apparent planting direction effects

cstand<- ggplot(dir2, aes(x = Trt_crmp, y = stand, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(cstand)
# no apparent crimpng direction effects

cstand<- ggplot(dir2, aes(x = Trt_num, y = stand)) + 
          geom_boxplot() +
          theme_bw()
print(cstand)
# no apparent treatment differences
```

```{r plot corn stand rep effect}
cstandrep<- ggplot(dir2, aes(x = Rep, y = stand)) +
          geom_boxplot() +
          theme_bw()
print(cstandrep)

# no apparent rep effects

# anova of reps to determine if statistically different
cstandrep<- anova_test(stand ~ Rep, data=dir2)
cstandrep
# not significant
```

```{r model corn stand trt vs ctrl}
# first test if treatments are different from control
model.cstand<- lmer(Corn_stand ~ Trt_num * Weediness + (1 | Year/Rep) + (1 | Location/Rep), data=dir)
summary(model.cstand)
anova(model.cstand)

## model reduction
model.cstand.best<- get_model(lmerTest::step(model.cstand, reduce.random=F))
summary(model.cstand.best)
anova(model.cstand.best)

# no difference between treatments & control
```

```{r corn stand trt vs ctrl test assumptions}
# check residuals
resid.model.cstand<- resid(model.cstand.best)
pred.model.cstand<- predict(model.cstand.best)

# check randomness
plot(pred.model.cstand, resid.model.cstand, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals") # all along same line

# check normality
hist(resid.model.cstand, main="Histogram of Residuals", xlab="Corn stand") # almost all same frequency

qqnorm(resid.model.cstand) 

# Shapiro-Wilk test
shapiro.test(resid.model.cstand)
```

```{r corn stand trt vs ctrl means}
cstandemmeans<- emmeans(model.cstand.best, pairwise ~ Trt_num*Weediness)
cstandemmeans
```

*Best Model:*
Corn_stand ~ Trt_num * Weediness + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*
                  Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    
Trt_num           296.97  59.394     5 129.96  3.2882  0.007894 ** 
Weediness          64.00  64.000     1 129.96  3.5432  0.062028 .  
Trt_num:Weediness 545.25 109.050     5 129.96  6.0372 4.662e-05 ***

*Assumptions:*
Good

*Means:*
 Trt_num Weediness emmean   SE   df lower.CL upper.CL
 1       W           23.0 5.27 1.47   -9.509     55.6
 2       W           22.7 5.27 1.47   -9.842     55.3
 3       W           28.7 5.27 1.47   -3.842     61.3
 4       W           29.1 5.27 1.47   -3.426     61.7
 5       W           31.9 5.27 1.47   -0.676     64.4
 6       W           28.1 5.27 1.47   -4.426     60.7
 1       WF          29.0 5.27 1.47   -3.592     61.5
 2       WF          29.5 5.27 1.47   -3.009     62.1
 3       WF          29.4 5.27 1.47   -3.176     61.9
 4       WF          28.7 5.27 1.47   -3.842     61.3
 5       WF          27.5 5.27 1.47   -5.009     60.1
 6       WF          27.5 5.27 1.47   -5.092     60.0
 
*Contrasts:*
contrast    estimate   SE  df t.ratio p.value
 1 W - 2 W     0.3333 1.74 123  0.192  1.0000 
 1 W - 3 W    -5.6667 1.74 123 -3.266  0.0602 
 1 W - 4 W    -6.0833 1.74 123 -3.506  0.0299 
 1 W - 5 W    -8.8333 1.74 123 -5.091  0.0001 
 1 W - 6 W    -5.0833 1.74 123 -2.930  0.1436 
 1 W - 1 WF   -5.9167 1.74 123 -3.410  0.0398 
 1 W - 2 WF   -6.5000 1.74 123 -3.746  0.0139 
 1 W - 3 WF   -6.3333 1.74 123 -3.650  0.0190 
 1 W - 4 WF   -5.6667 1.74 123 -3.266  0.0602 
 1 W - 5 WF   -4.5000 1.74 123 -2.594  0.2949 
 1 W - 6 WF   -4.4167 1.74 123 -2.546  0.3226 
 2 W - 3 W    -6.0000 1.74 123 -3.458  0.0345 
 2 W - 4 W    -6.4167 1.74 123 -3.698  0.0163 
 2 W - 5 W    -9.1667 1.74 123 -5.283  <.0001 
 2 W - 6 W    -5.4167 1.74 123 -3.122  0.0889 
 2 W - 1 WF   -6.2500 1.74 123 -3.602  0.0222 
 2 W - 2 WF   -6.8333 1.74 123 -3.938  0.0073 
 2 W - 3 WF   -6.6667 1.74 123 -3.842  0.0101 
 2 W - 4 WF   -6.0000 1.74 123 -3.458  0.0345 
 2 W - 5 WF   -4.8333 1.74 123 -2.786  0.1993 
 2 W - 6 WF   -4.7500 1.74 123 -2.738  0.2209 
 3 W - 4 W    -0.4167 1.74 123 -0.240  1.0000 
 3 W - 5 W    -3.1667 1.74 123 -1.825  0.8011 
 3 W - 6 W     0.5833 1.74 123  0.336  1.0000 
 3 W - 1 WF   -0.2500 1.74 123 -0.144  1.0000 
 3 W - 2 WF   -0.8333 1.74 123 -0.480  1.0000 
 3 W - 3 WF   -0.6667 1.74 123 -0.384  1.0000 
 3 W - 4 WF    0.0000 1.74 123  0.000  1.0000 
 3 W - 5 WF    1.1667 1.74 123  0.672  0.9999 
 3 W - 6 WF    1.2500 1.74 123  0.720  0.9999 
 4 W - 5 W    -2.7500 1.74 123 -1.585  0.9113 
 4 W - 6 W     1.0000 1.74 123  0.576  1.0000 
 4 W - 1 WF    0.1667 1.74 123  0.096  1.0000 
 4 W - 2 WF   -0.4167 1.74 123 -0.240  1.0000 
 4 W - 3 WF   -0.2500 1.74 123 -0.144  1.0000 
 4 W - 4 WF    0.4167 1.74 123  0.240  1.0000 
 4 W - 5 WF    1.5833 1.74 123  0.913  0.9989 
 4 W - 6 WF    1.6667 1.74 123  0.961  0.9982 
 5 W - 6 W     3.7500 1.74 123  2.161  0.5804 
 5 W - 1 WF    2.9167 1.74 123  1.681  0.8734 
 5 W - 2 WF    2.3333 1.74 123  1.345  0.9713 
 5 W - 3 WF    2.5000 1.74 123  1.441  0.9528 
 5 W - 4 WF    3.1667 1.74 123  1.825  0.8011 
 5 W - 5 WF    4.3333 1.74 123  2.497  0.3515 
 5 W - 6 WF    4.4167 1.74 123  2.546  0.3226 
 6 W - 1 WF   -0.8333 1.74 123 -0.480  1.0000 
 6 W - 2 WF   -1.4167 1.74 123 -0.816  0.9996 
 6 W - 3 WF   -1.2500 1.74 123 -0.720  0.9999 
 6 W - 4 WF   -0.5833 1.74 123 -0.336  1.0000 
 6 W - 5 WF    0.5833 1.74 123  0.336  1.0000 
 6 W - 6 WF    0.6667 1.74 123  0.384  1.0000 
 1 WF - 2 WF  -0.5833 1.74 123 -0.336  1.0000 
 1 WF - 3 WF  -0.4167 1.74 123 -0.240  1.0000 
 1 WF - 4 WF   0.2500 1.74 123  0.144  1.0000 
 1 WF - 5 WF   1.4167 1.74 123  0.816  0.9996 
 1 WF - 6 WF   1.5000 1.74 123  0.865  0.9993 
 2 WF - 3 WF   0.1667 1.74 123  0.096  1.0000 
 2 WF - 4 WF   0.8333 1.74 123  0.480  1.0000 
 2 WF - 5 WF   2.0000 1.74 123  1.153  0.9914 
 2 WF - 6 WF   2.0833 1.74 123  1.201  0.9880 
 3 WF - 4 WF   0.6667 1.74 123  0.384  1.0000 
 3 WF - 5 WF   1.8333 1.74 123  1.057  0.9959 
 3 WF - 6 WF   1.9167 1.74 123  1.105  0.9940 
 4 WF - 5 WF   1.1667 1.74 123  0.672  0.9999 
 4 WF - 6 WF   1.2500 1.74 123  0.720  0.9999 
 5 WF - 6 WF   0.0833 1.74 123  0.048  1.0000 


```{r model corn stand trt level, results='hide', message=FALSE, warning=FALSE}
# first test if treatments are different from control
model.cstandtrt<- lmer(Corn_stand ~ Trt_plnt * Trt_crmp * Weediness + (1 | Year/Rep) + (1 | Location/Rep), data=dirtrt)
summary(model.cstandtrt)
anova(model.cstandtrt)

## model reduction
model.cstandtrt.best<- get_model(lmerTest::step(model.cstandtrt, reduce.random=F))
summary(model.cstandtrt.best)
anova(model.cstandtrt.best)
```

```{r corn stand model assumptions, results='hide', message=FALSE, warning=FALSE,}
# check residuals
resid.model.cstandt<- resid(model.cstandtrt.best)
pred.model.cstandt<- predict(model.cstandtrt.best)

# check randomness
plot(pred.model.cstandt, resid.model.cstandt, ylab="Residuals", xlab="Corn stand", main="Predictecd vs Residuals") # all along same line

# check normality
hist(resid.model.cstandt, main="Histogram of Residuals", xlab="Corn stand") 

qqnorm(resid.model.cstandt) 

# Shapiro-Wilk test
shapiro.test(resid.model.cstandt)
```

```{r corn stand difference of means, results='hide', message=FALSE, warning=FALSE}
# no signficant main effects to compare means
```
*Best Model:*
Corn_stand ~ (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Fine

*Means:*
None


### corn height

```{r plot corn height}
height<- ggplot(dir, aes(x = Weediness, y = Corn_ht_av)) + 
          geom_boxplot() +
          theme_bw()
print(height)
# shorter in weedy

height<- ggplot(dir, aes(x = Trt_plnt, y = Corn_ht_av, fill=Weediness)) + 
          geom_boxplot() +
          theme_bw()
print(height)
# no apparent plantind direction effects

height<- ggplot(dir, aes(x = Trt_crmp, y = Corn_ht_av, fill=Weediness)) + 
          geom_boxplot() +
          theme_bw()
print(height)
# no apparent crimpng direction effects

height<- ggplot(dir, aes(x = Trt_num, y = Corn_ht_av)) + 
          geom_boxplot() +
          theme_bw()
print(height)
# trts 1 & 2 highest -> no c.c. N & E

height<- ggplot(dir, aes(x = Trt_num, y = Corn_ht_av, fill=Weediness)) + 
          geom_boxplot() +
          theme_bw()
print(height)
# weediness only affects control plots so possibly elevating above graph
```

```{r plot corn height rep effect}
heightrep<- ggplot(dir, aes(x = Rep, y = Corn_ht_av)) +
          geom_boxplot() +
          theme_bw()
print(heightrep)

# no apparent rep effects

# anova of reps to determine if statistically different
heightrep<- anova_test(Corn_ht_av ~ Rep, data=dir)
heightrep
# not significant
```

```{r model corn height trt vs ctrl }
# first test if treatments are different from control
model.ht<- lmer(Corn_ht_av ~ Trt_num * Weediness + (1 | Year/Rep) + (1 | Location/Rep), data=dir)
summary(model.ht)
anova(model.ht)

## model reduction
model.ht.best<- get_model(lmerTest::step(model.ht, reduce.random=F))
summary(model.ht.best)
anova(model.ht.best)
```

```{r corn ht trt vs ctrl assumptions}
# check residuals
resid.model.ht<- resid(model.ht.best)
pred.model.ht<- predict(model.ht.best)

# check randomness
plot(pred.model.ht, resid.model.ht, ylab="Residuals", xlab="Corn ht", main="Predictecd vs Residuals") 

# check normality
hist(resid.model.ht, main="Histogram of Residuals", xlab="Corn ht")

qqnorm(resid.model.ht) 

# Shapiro-Wilk test
shapiro.test(resid.model.ht)
```

```{r corn ht trt vs ctrl means}
# test means to see if treatments are different from control
htmean<- emmeans(model.ht.best, pairwise ~ Trt_num*Weediness)
htmean
```
*Best Model:*
Corn_ht_av ~ Trt_num * Weediness + (1 | Year/Rep) + (1 | Location/Rep)

*Effects:*


*Assumptions:*
Fine

*Means:*
 Trt_num Weediness emmean   SE   df lower.CL upper.CL
 1       W           54.8 4.95 1.83     31.5     78.1
 2       W           55.9 4.95 1.83     32.6     79.2
 3       W           57.8 4.95 1.83     34.5     81.0
 4       W           59.7 4.95 1.83     36.4     82.9
 5       W           61.4 4.95 1.83     38.1     84.6
 6       W           58.8 4.95 1.83     35.5     82.1
 1       WF          71.1 4.95 1.83     47.8     94.3
 2       WF          70.5 4.95 1.83     47.2     93.8
 3       WF          58.6 4.95 1.83     35.3     81.8
 4       WF          60.3 4.95 1.83     37.0     83.6
 5       WF          60.2 4.95 1.83     36.9     83.5
 6       WF          58.7 4.95 1.83     35.4     81.9

*Contrasts:*
 contrast    estimate   SE  df t.ratio p.value
 1 W - 2 W    -1.1083 2.58 123 -0.430  1.0000 
 1 W - 3 W    -2.9917 2.58 123 -1.160  0.9910 
 1 W - 4 W    -4.8667 2.58 123 -1.887  0.7650 
 1 W - 5 W    -6.5833 2.58 123 -2.552  0.3186 
 1 W - 6 W    -4.0000 2.58 123 -1.551  0.9228 
 1 W - 1 WF  -16.2750 2.58 123 -6.310  <.0001 *
 1 W - 2 WF  -15.7250 2.58 123 -6.097  <.0001 *
 1 W - 3 WF   -3.7917 2.58 123 -1.470  0.9458 
 1 W - 4 WF   -5.5250 2.58 123 -2.142  0.5941 
 1 W - 5 WF   -5.4333 2.58 123 -2.106  0.6192 
 1 W - 6 WF   -3.8750 2.58 123 -1.502  0.9373 
 2 W - 3 W    -1.8833 2.58 123 -0.730  0.9999 
 2 W - 4 W    -3.7583 2.58 123 -1.457  0.9490 
 2 W - 5 W    -5.4750 2.58 123 -2.123  0.6078 
 2 W - 6 W    -2.8917 2.58 123 -1.121  0.9932 
 2 W - 1 WF  -15.1667 2.58 123 -5.880  <.0001 *
 2 W - 2 WF  -14.6167 2.58 123 -5.667  <.0001 *
 2 W - 3 WF   -2.6833 2.58 123 -1.040  0.9964 
 2 W - 4 WF   -4.4167 2.58 123 -1.712  0.8592 
 2 W - 5 WF   -4.3250 2.58 123 -1.677  0.8752 
 2 W - 6 WF   -2.7667 2.58 123 -1.073  0.9953 
 3 W - 4 W    -1.8750 2.58 123 -0.727  0.9999 
 3 W - 5 W    -3.5917 2.58 123 -1.392  0.9629 
 3 W - 6 W    -1.0083 2.58 123 -0.391  1.0000 
 3 W - 1 WF  -13.2833 2.58 123 -5.150  0.0001 *
 3 W - 2 WF  -12.7333 2.58 123 -4.937  0.0002 *
 3 W - 3 WF   -0.8000 2.58 123 -0.310  1.0000 
 3 W - 4 WF   -2.5333 2.58 123 -0.982  0.9978 
 3 W - 5 WF   -2.4417 2.58 123 -0.947  0.9984 
 3 W - 6 WF   -0.8833 2.58 123 -0.342  1.0000 
 4 W - 5 W    -1.7167 2.58 123 -0.666  0.9999 
 4 W - 6 W     0.8667 2.58 123  0.336  1.0000 
 4 W - 1 WF  -11.4083 2.58 123 -4.423  0.0012 *
 4 W - 2 WF  -10.8583 2.58 123 -4.210  0.0028 *
 4 W - 3 WF    1.0750 2.58 123  0.417  1.0000 
 4 W - 4 WF   -0.6583 2.58 123 -0.255  1.0000 
 4 W - 5 WF   -0.5667 2.58 123 -0.220  1.0000 
 4 W - 6 WF    0.9917 2.58 123  0.384  1.0000 
 5 W - 6 W     2.5833 2.58 123  1.002  0.9974 
 5 W - 1 WF   -9.6917 2.58 123 -3.757  0.0134 *
 5 W - 2 WF   -9.1417 2.58 123 -3.544  0.0266 *
 5 W - 3 WF    2.7917 2.58 123  1.082  0.9949 
 5 W - 4 WF    1.0583 2.58 123  0.410  1.0000 
 5 W - 5 WF    1.1500 2.58 123  0.446  1.0000 
 5 W - 6 WF    2.7083 2.58 123  1.050  0.9961 
 6 W - 1 WF  -12.2750 2.58 123 -4.759  0.0003 *
 6 W - 2 WF  -11.7250 2.58 123 -4.546  0.0008 *
 6 W - 3 WF    0.2083 2.58 123  0.081  1.0000 
 6 W - 4 WF   -1.5250 2.58 123 -0.591  1.0000 
 6 W - 5 WF   -1.4333 2.58 123 -0.556  1.0000 
 6 W - 6 WF    0.1250 2.58 123  0.048  1.0000 
 1 WF - 2 WF   0.5500 2.58 123  0.213  1.0000 
 1 WF - 3 WF  12.4833 2.58 123  4.840  0.0002 *
 1 WF - 4 WF  10.7500 2.58 123  4.168  0.0032 *
 1 WF - 5 WF  10.8417 2.58 123  4.203  0.0028 *
 1 WF - 6 WF  12.4000 2.58 123  4.807  0.0003 *
 2 WF - 3 WF  11.9333 2.58 123  4.627  0.0006 *
 2 WF - 4 WF  10.2000 2.58 123  3.955  0.0069 *
 2 WF - 5 WF  10.2917 2.58 123  3.990  0.0061 *
 2 WF - 6 WF  11.8500 2.58 123  4.594  0.0006 *
 3 WF - 4 WF  -1.7333 2.58 123 -0.672  0.9999 
 3 WF - 5 WF  -1.6417 2.58 123 -0.636  1.0000 
 3 WF - 6 WF  -0.0833 2.58 123 -0.032  1.0000 
 4 WF - 5 WF   0.0917 2.58 123  0.036  1.0000 
 4 WF - 6 WF   1.6500 2.58 123  0.640  1.0000 
 5 WF - 6 WF   1.5583 2.58 123  0.604  1.0000 


```{r model corn height trt level, results='hide', message=FALSE, warning=FALSE}
# test if treatments are different from each other
model.ht2<- lmer(height ~ Trt_plnt * Trt_crmp * weediness + ( 1 | Rep), data=dir3trt)
summary(model.ht2)
anova(model.ht2)

## model reduction
model.ht2.best<- get_model(lmerTest::step(model.ht2, reduce.random=F))
summary(model.ht2.best)
anova(model.ht2.best)
### best model:  height ~ Trt_plnt + Trt_crmp + (1 | Rep) + Trt_plnt:Trt_crmp
```

```{r corn height model assumptions, results='hide', message=FALSE, warning=FALSE}
# check residuals
resid.model.ht<- resid(model.ht2.best)
pred.model.ht<- predict(model.ht2.best)

# check randomness
plot(pred.model.ht, resid.model.ht, ylab="Residuals", xlab="Corn height", main="Predictecd vs Residuals")

# check normality
hist(resid.model.ht, main="Histogram of Residuals", xlab="Corn height")

qqnorm(resid.model.ht) 

# Shapiro-Wilk test
shapiro.test(resid.model.ht)
# test assumptions good
```

```{r corn height difference of means}
htmean2<- emmeans(model.ht2.best, pairwise ~ Trt_plnt)
htmean2
# not significant
# corn planted into rye planted East 0.325cm taller than North rye

htmean3<- emmeans(model.ht2.best, pairwise ~ Trt_crmp)
htmean3
# not significant
# East corn planting & crimping 0.425cm taller than North planting & crimping

htmean4<- emmeans(model.ht2.best, pairwise ~ Trt_plnt*Trt_crmp)
htmean4
# not significant
# NE & EN taller than EE & NN -> i.e. perpendicular taller than parallel
```


### corn injury

Need to figure out how to make data in long form for time & weediness
```{r corn injury data modifications, results='hide', message=FALSE, warning=FALSE}
```

```{r plot corn injury, results='hide', message=FALSE, warning=FALSE}

```

```{r plot corn injury rep effect, results='hide', message=FALSE, warning=FALSE}

```

```{r model corn injury trt vs control, results='hide', message=FALSE, warning=FALSE}

```

```{r model corn injury trt level, results='hide', message=FALSE, warning=FALSE}

```

```{r corn injury model assumptions, results='hide', message=FALSE, warning=FALSE}

```

```{r corn injury difference of means, results='hide', message=FALSE, warning=FALSE}
# 
```


### corn tasseling


### corn marketable count

```{r marketable count data modifications, results='hide', message=FALSE, warning=FALSE}
# use dir
# make long form for weedy/weed-free
dir4 <- dir %>%
  gather(key = "weediness", value = "count", W_M_count,	WF_M_count) %>%
  convert_as_factor(Plot, weediness)

dir4$Trt_num<- as.factor(dir4$Trt_num)

# remove control for comparing treatments
dir4trt<- subset(dir4, Trt_plnt=="E"|Trt_plnt=="N")
```

```{r plot corn marketable count}
mcount<- ggplot(dir4, aes(x = weediness, y = count)) + 
          geom_boxplot() +
          theme_bw()
print(mcount)
# higher count in weed-free

mcount<- ggplot(dir4, aes(x = Trt_plnt, y = count, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(mcount)
# no apparent planting direction effects

mcount<- ggplot(dir4, aes(x = Trt_crmp, y = count, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(mcount)
# no apparent crimpng direction effects

mcount<- ggplot(dir4, aes(x = Trt_num, y = count)) + 
          geom_boxplot() +
          theme_bw()
print(mcount)
# no apparent treatment differences

mcount<- ggplot(dir4, aes(x = Trt_num, y = count, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(mcount)
# weed-free higher in all cases, no other trends evident
```

```{r plot corn marketable yield rep effect, results='hide', message=FALSE, warning=FALSE}
mcountrep<- ggplot(dir4, aes(x = Rep, y = count)) +
          geom_boxplot() +
          theme_bw()
print(mcountrep)
# no apparent rep effects

# anova of reps to determine if statistically different
mcountrep<- anova_test(count ~ Rep, data=dir4)
mcountrep
# not significant
```

```{r model corn marketable count trt vs control}
# first test if treatments are different from control
model.mcount1<- lmer(count ~ Trt_num * weediness + ( 1 | Rep), data=dir4)
summary(model.mcount1)
anova(model.mcount1)

## model reduction
model.mcount1.best<- get_model(lmerTest::step(model.mcount1, reduce.random=F))
summary(model.mcount1.best)
anova(model.mcount1.best)
### best model: count ~ Trt_num * weediness + (1 | Rep)

mcountmean1<- emmeans(model.mcount1.best, pairwise ~ Trt_num*weediness)
mcountmean1
# weedy control 1 lower than weedy trt5
# weedy control 2 lower than weedy trt 3, 5, 6
# weed free ctrl 1 & 2 not diff from wf trts

plot(mcountmean1)
```

```{r model corn marketable count trt level, results='hide', message=FALSE, warning=FALSE}
# test if treatments are different from each other
model.mcount2<- lmer(count ~ Trt_plnt * Trt_crmp * weediness + ( 1 | Rep), data=dir4trt)
summary(model.mcount2)
anova(model.mcount2)

## model reduction
model.mcount2.best<- get_model(lmerTest::step(model.mcount2, reduce.random=F))
summary(model.mcount2.best)
anova(model.mcount2.best)
### best model: count ~ weediness + (1 | Rep)
```

```{r corn marketable count model assumptions, results='hide', message=FALSE, warning=FALSE}
# check residuals
resid.model.mcount<- resid(model.mcount2.best)
pred.model.mcount<- predict(model.mcount2.best)

# check randomness
plot(pred.model.mcount, resid.model.mcount, ylab="Residuals", xlab="Corn marketable count", main="Predictecd vs Residuals") # divided in 2

# check normality
hist(resid.model.mcount, main="Histogram of Residuals", xlab="Corn marketable count") 

qqnorm(resid.model.mcount) 

# Shapiro-Wilk test
shapiro.test(resid.model.mcount)
# test assumptions met
```

```{r corn marketable count difference of means}
mcountmean2<- emmeans(model.mcount2.best, pairwise ~ weediness)
mcountmean2
# 8.69 more marketable cobs in weed-free than weedy
```


### corn marketable weight

```{r marketable weight data modifications, results='hide', message=FALSE, warning=FALSE}
# use dir
# make long form for weedy/weed-free
dir5 <- dir %>%
  gather(key = "weediness", value = "weight", W_M_wt,	WF_M_wt) %>%
  convert_as_factor(Plot, weediness)

dir5$Trt_num<- as.factor(dir5$Trt_num)

# remove control for comparing treatments
dir5trt<- subset(dir5, Trt_plnt=="E"|Trt_plnt=="N")
```

```{r plot corn marketable weight}
mwt<- ggplot(dir5, aes(x = weediness, y = weight)) + 
          geom_boxplot() +
          theme_bw()
print(mwt)
# higher weight in weed-free

mwt<- ggplot(dir5, aes(x = Trt_plnt, y = weight, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(mwt)
# no apparent planting direction effects

mwt<- ggplot(dir5, aes(x = Trt_crmp, y = weight, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(mwt)
# no apparent crimpng direction effects

mwt<- ggplot(dir5, aes(x = Trt_num, y = weight)) + 
          geom_boxplot() +
          theme_bw()
print(mwt)
# no apparent treatment differences

mwt<- ggplot(dir5, aes(x = Trt_num, y = weight, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(mwt)
# weed-free higher in all cases, no other trends evident
```

```{r plot corn marketable weight rep effect, results='hide', message=FALSE, warning=FALSE}
mwtrep<- ggplot(dir5, aes(x = Rep, y = weight)) +
          geom_boxplot() +
          theme_bw()
print(mwtrep)
# no apparent rep effects

# anova of reps to determine if statistically different
mwtrep<- anova_test(weight ~ Rep, data=dir5)
mwtrep
# not significant
```

```{r model corn marketable weight trt vs control}
# first test if treatments are different from control
model.mwt1<- lmer(weight ~ Trt_num * weediness + ( 1 | Rep), data=dir5)
summary(model.mwt1)
anova(model.mwt1)

## model reduction
model.mwt1.best<- get_model(lmerTest::step(model.mwt1, reduce.random=F))
summary(model.mwt1.best)
anova(model.mwt1.best)
### best model: weight ~ Trt_num * weediness + (1 | Rep)

mwtmean1<- emmeans(model.mwt1.best, pairwise ~ Trt_num*weediness)
mwtmean1
# weedy control 1 lower than weedy trt5
# weedy control 2 lower than weedy trt 3, 5, 6
# weed free ctrl 1 & 2 higher than all other wf trts

plot(mwtmean1)
# seems to be measurable affect of rye cover crop
## evident by difference in weed-free yield
### also East-planted corn did worse in weedy than North
```

```{r model corn marketable weight trt level, results='hide', message=FALSE, warning=FALSE}
# test if treatments are different from each other
model.mwt2<- lmer(weight ~ Trt_plnt * Trt_crmp * weediness + ( 1 | Rep), data=dir5trt)
summary(model.mwt2)
anova(model.mwt2)

## model reduction
model.mwt2.best<- get_model(lmerTest::step(model.mwt2, reduce.random=F))
summary(model.mwt2.best)
anova(model.mwt2.best)
### best model: weight ~ weediness + (1 | Rep)
```

```{r corn marketable weight model assumptions, results='hide', message=FALSE, warning=FALSE}
# check residuals
resid.model.mwt<- resid(model.mwt2.best)
pred.model.mwt<- predict(model.mwt2.best)

# check randomness
plot(pred.model.mwt, resid.model.mwt, ylab="Residuals", xlab="Corn marketable weight", main="Predictecd vs Residuals") # divided in 2

# check normality
hist(resid.model.mwt, main="Histogram of Residuals", xlab="Corn marketable weight") 

qqnorm(resid.model.mwt) 

# Shapiro-Wilk test
shapiro.test(resid.model.mwt)
# test assumptions met
```

```{r corn marketable weight difference of means}
mwtmean2<- emmeans(model.mwt2.best, pairwise ~ weediness)
mwtmean2
# 2.13 more marketable weight in weed-free than weedy
```


### corn unmarketable count

```{r unmarketable count data modifications, results='hide', message=FALSE, warning=FALSE}
# use dir
# make long form for weedy/weed-free
dir6 <- dir %>%
  gather(key = "weediness", value = "count", W_UM_count,	WF_UM_count) %>%
  convert_as_factor(Plot, weediness)

dir6$Trt_num<- as.factor(dir6$Trt_num)

# remove control for comparing treatments
dir6trt<- subset(dir6, Trt_plnt=="E"|Trt_plnt=="N")
```

```{r plot corn unmarketable count}
umcount<- ggplot(dir6, aes(x = weediness, y = count)) + 
          geom_boxplot() +
          theme_bw()
print(umcount)
# higher count in weed-free

umcount<- ggplot(dir6, aes(x = Trt_plnt, y = count, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(umcount)
# no apparent planting direction effects

umcount<- ggplot(dir6, aes(x = Trt_crmp, y = count, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(umcount)
# no apparent crimpng direction effects

umcount<- ggplot(dir6, aes(x = Trt_num, y = count)) + 
          geom_boxplot() +
          theme_bw()
print(umcount)
# no apparent treatment differences

umcount<- ggplot(dir6, aes(x = Trt_num, y = count, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(umcount)
# weed-free higher in controls but not in trts, lower in wf trts than wf ctrls, lower in w ctrls than w trts
# might be evidence of later maturity in cover crop
```

```{r plot corn unmarketable count rep effect, results='hide', message=FALSE, warning=FALSE}
umcountrep<- ggplot(dir6, aes(x = Rep, y = count)) +
          geom_boxplot() +
          theme_bw()
print(umcountrep)
# no apparent rep effects

# anova of reps to determine if statistically different
umcountrep<- anova_test(count ~ Rep, data=dir6)
umcountrep
# not significant
```

```{r model corn unmarketable count trt vs control}
# first test if treatments are different from control
model.umcount1<- lmer(count ~ Trt_num * weediness + ( 1 | Rep), data=dir6)
summary(model.umcount1)
anova(model.umcount1)

## model reduction
model.umcount1.best<- get_model(lmerTest::step(model.umcount1, reduce.random=F))
summary(model.umcount1.best)
anova(model.umcount1.best)
### best model: count ~ Trt_num * weediness + (1 | Rep)

umcountmean1<- emmeans(model.umcount1.best, pairwise ~ Trt_num*weediness)
umcountmean1
# weedy & wf ctrls not diff from weedy & wf trts
# highest weedy means in 3, 4, 6
# highest wf means in 1, 2, 3

plot(umcountmean1)
```

```{r model corn unmarketable count trt level, results='hide', message=FALSE, warning=FALSE}
# test if treatments are different from each other
model.umcount2<- lmer(count ~ Trt_plnt * Trt_crmp * weediness + ( 1 | Rep), data=dir6trt)
summary(model.umcount2)
anova(model.umcount2)

## model reduction
model.umcount2.best<- get_model(lmerTest::step(model.umcount2, reduce.random=F))
summary(model.umcount2.best)
anova(model.umcount2.best)
### best model: count ~ (1 | Rep)
```

```{r corn unmarketable count model assumptions, results='hide', message=FALSE, warning=FALSE}
# check residuals
resid.model.umcount<- resid(model.umcount2.best)
pred.model.umcount<- predict(model.umcount2.best)

# check randomness
plot(pred.model.umcount, resid.model.umcount, ylab="Residuals", xlab="Corn unmarketable count", main="Predictecd vs Residuals") 

# check normality
hist(resid.model.umcount, main="Histogram of Residuals", xlab="Corn unmarketable count") 

qqnorm(resid.model.umcount) 

# Shapiro-Wilk test
shapiro.test(resid.model.umcount)
# test assumptions met
```

```{r corn unmarketable count difference of means}
# no main effects
```


### corn unmarketable weight

```{r unmarketable weight data modifications, results='hide', message=FALSE, warning=FALSE}
# use dir
# make long form for weedy/weed-free
dir7 <- dir %>%
  gather(key = "weediness", value = "weight", W_UM_wt,	WF_UM_wt) %>%
  convert_as_factor(Plot, weediness)

dir7$Trt_num<- as.factor(dir7$Trt_num)

# remove control for comparing treatments
dir7trt<- subset(dir7, Trt_plnt=="E"|Trt_plnt=="N")
```

```{r plot corn unmarketable weight}
umwt<- ggplot(dir7, aes(x = weediness, y = weight)) + 
          geom_boxplot() +
          theme_bw()
print(umwt)
# higher weight in weed-free

umwt<- ggplot(dir7, aes(x = Trt_plnt, y = weight, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(umwt)
# slightly higher in north rye planted?

umwt<- ggplot(dir7, aes(x = Trt_crmp, y = weight, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(umwt)
# no apparent crimpng direction effects

umwt<- ggplot(dir7, aes(x = Trt_num, y = weight)) + 
          geom_boxplot() +
          theme_bw()
print(umwt)
# no apparent treatment differences

umwt<- ggplot(dir7, aes(x = Trt_num, y = weight, fill=weediness)) + 
          geom_boxplot() +
          theme_bw()
print(umwt)
# weed-free higher in most cases, more in wf ctrls than wf trts, more in w trts than w ctrls
```

```{r plot corn unmarketable weight rep effect, results='hide', message=FALSE, warning=FALSE}
umwtrep<- ggplot(dir7, aes(x = Rep, y = weight)) +
          geom_boxplot() +
          theme_bw()
print(umwtrep)
# no apparent rep effects

# anova of reps to determine if statistically different
umwtrep<- anova_test(weight ~ Rep, data=dir7)
umwtrep
# not significant
```

```{r model corn unmarketable weight trt vs control}
# first test if treatments are different from control
model.umwt1<- lmer(weight ~ Trt_num * weediness + ( 1 | Rep), data=dir7)
summary(model.umwt1)
anova(model.umwt1)

## model reduction
model.umwt1.best<- get_model(lmerTest::step(model.umwt1, reduce.random=F))
summary(model.umwt1.best)
anova(model.umwt1.best)
### best model: weight ~ Trt_num * weediness + (1 | Rep)

umwtmean1<- emmeans(model.umwt1.best, pairwise ~ Trt_num*weediness)
umwtmean1
# weedy ctrl 1 lower than weedy trt 4
# weedy ctrl 2 not diff from weedy trts
# wf ctrls not diff from wf trts

plot(umwtmean1)
# trend almost reverses for wf vs weedy
```

```{r model corn unmarketable weight trt level, results='hide', message=FALSE, warning=FALSE}
# test if treatments are different from each other
model.umwt2<- lmer(weight ~ Trt_plnt * Trt_crmp * weediness + ( 1 | Rep), data=dir7trt)
summary(model.umwt2)
anova(model.umwt2)

## model reduction
model.umwt2.best<- get_model(lmerTest::step(model.umwt2, reduce.random=F))
summary(model.umwt2.best)
anova(model.umwt2.best)
### best model: weight ~ Trt_plnt + (1 | Rep)
```

```{r corn unmarketable weight model assumptions, results='hide', message=FALSE, warning=FALSE}
# check residuals
resid.model.umwt<- resid(model.umwt2.best)
pred.model.umwt<- predict(model.umwt2.best)

# check randomness
plot(pred.model.umwt, resid.model.umwt, ylab="Residuals", xlab="Corn unmarketable weight", main="Predictecd vs Residuals") # divided in 2

# check normality
hist(resid.model.umwt, main="Histogram of Residuals", xlab="Corn unmarketable weight") # not normal 

qqnorm(resid.model.umwt) 

# Shapiro-Wilk test
shapiro.test(resid.model.umwt)
# test assumptions mostly met
```

```{r corn unmarketable weight difference of means}
umwtmean2<- emmeans(model.umwt2.best, pairwise ~ Trt_plnt)
umwtmean2
# 0.278kg more unmarketable weight in North planted rye than East
# no idea why that would be...
```


### total weed count

```{r weed count data modifications, results='hide', message=FALSE, warning=FALSE}
# table with sums of weed counts & standard deviation for within each combination of rye planting direction, rye crimping/corn planting direction, and time 
wtab<-dirw %>%
  group_by(Plot, Rep, Trt_num, Trt_plnt, Trt_crmp, Time) %>%
  summarize(CountSum=sum(Count), SD=sd(Count))

wtab$Time<- factor(wtab$Time, levels = c("PRE","28DAT","56DAT")) # reorder Time levels so chronological

wtab<- wtab[-73,] # weird row at end containing NAs -> need to find source

wtabtrt<- subset(wtab, Trt_plnt=="E"|Trt_plnt=="N")
```

```{r plot weed counts}
weed<- ggplot(wtab, aes(x = Trt_plnt, y = CountSum)) + 
          geom_boxplot() +
          theme_bw()
print(weed)

weed<- ggplot(wtab, aes(x = Trt_crmp, y = CountSum)) + 
          geom_boxplot() +
          theme_bw()
print(weed)

weed<- ggplot(wtab, aes(x = Trt_plnt, y = CountSum, fill = Trt_crmp)) + 
          geom_boxplot() +
          theme_bw()
print(weed)

weed<- ggplot(wtab, aes(x = Time, y = CountSum, fill = Trt_plnt)) + 
          geom_boxplot() +
          theme_bw()
print(weed)

weed<- ggplot(wtab, aes(x = Time, y = CountSum, fill = Trt_crmp)) + 
          geom_boxplot() +
          theme_bw()
print(weed)

weed<- ggplot(wtab, aes(x = Time, y = CountSum, fill = Trt_num)) + 
          geom_boxplot() +
          theme_bw()
print(weed)
# no apparent treatment effects at any time, but all lower & less variation than ctrls
```

```{r plot weed count rep effect, results='hide', message=FALSE, warning=FALSE}
weedrep<- ggplot(wtab, aes(x = Rep, y = CountSum)) +
          geom_boxplot() +
          theme_bw()
print(weedrep)
# no apparent rep effects

# anova of reps to determine if statistically different
# weedrep<- anova_test(CountSum ~ Rep, data=wtab) 
# not working for some reason
# weedrep
# 
```

```{r model weed count trt vs control}
# first test if treatments are different from control
model.wcount1<- glmer(CountSum ~ Trt_num * Time + ( 1 | Rep) + (1 | Plot), data=wtab, family=poisson)
summary(model.wcount1)
Anova(model.wcount1, type="III")

wcountmean1<- emmeans(model.wcount1, pairwise ~ Trt_num * Time)
wcountmean1
# diffs btwn ctrls & trts PRE
# no diffs btwn ctrls & trts 28DAT & 56DAT

plot(wcountmean1)
```

```{r model weed count trt level, results='hide', message=FALSE, warning=FALSE}
# test if treatments are different from each other
model.wcount2<- glmer(CountSum ~ Trt_plnt * Trt_crmp * Time + ( 1 | Rep) + (1 | Plot), data=wtabtrt, family=poisson)
summary(model.wcount2) # AIC = 432.8
Anova(model.wcount2, type="III")

# model reduction
step<- stepcAIC(model.wcount2, data=wtabtrt, trace=T, direction="backward", returnResult=T)

# best model: CountSum ~ Trt_plnt + Trt_crmp + Time + (1 | Plot) + (1 | Rep)

model.wcount2.best<- glmer(CountSum ~ Trt_plnt + Trt_crmp + Time + (1 | Plot) + (1 | Rep), data=wtabtrt, family=poisson)
```

```{r weed count model assumptions, results='hide', message=FALSE, warning=FALSE}
# check residuals
resid.model.wcount<- resid(model.wcount2.best)
pred.model.wcount<- predict(model.wcount2.best)

# check randomness
plot(pred.model.wcount, resid.model.wcount, ylab="Residuals", xlab="Weed counts", main="Predictecd vs Residuals")

# check normality
hist(resid.model.wcount, main="Histogram of Residuals", xlab="Weed counts") # not quite normal but no patterned skewness

qqnorm(resid.model.wcount) 

# Shapiro-Wilk test
shapiro.test(resid.model.wcount)
# test assumptions mostly met
```

```{r weed count difference of means}
wcountmean2<- emmeans(model.wcount2.best, pairwise ~ Trt_plnt)
wcountmean2

wcountmean3<- emmeans(model.wcount2.best, pairwise ~ Trt_crmp)
wcountmean3

wcountmean4<- emmeans(model.wcount2.best, pairwise ~ Time)
wcountmean4
plot(wcountmean4)
# weed counts low 28DAT
```


### total weed biomass

```{r weed weight data modifications, results='hide', message=FALSE, warning=FALSE}
# table with sums of weed counts & standard deviation for within each combination of rye planting direction, rye crimping/corn planting direction, and time 
wtab2<-subset(dirw, Time=="56DAT") %>%
  group_by(Plot, Rep, Trt_num, Trt_plnt, Trt_crmp) %>%
  summarize(WeightSum=sum(Weight), WSD=sd(Weight))

wtab2trt<- subset(wtab2, Trt_plnt=="E"|Trt_plnt=="N")
```

```{r plot weed weights}
weedw<- ggplot(wtab2, aes(x = Trt_plnt, y = WeightSum)) + 
          geom_boxplot() +
          theme_bw()
print(weedw)

weedw<- ggplot(wtab2, aes(x = Trt_crmp, y = WeightSum)) + 
          geom_boxplot() +
          theme_bw()
print(weedw)

weedw<- ggplot(wtab2, aes(x = Trt_plnt, y = WeightSum, fill = Trt_crmp)) + 
          geom_boxplot() +
          theme_bw()
print(weedw)
# No apparent benefit to perpendicular crimping -- appears almost worse?
```

```{r plot weed weight rep effect, results='hide', message=FALSE, warning=FALSE}
weedwrep<- ggplot(wtab2, aes(x = Rep, y = WeightSum)) +
          geom_boxplot() +
          theme_bw()
print(weedwrep)
# no apparent rep effects

# anova of reps to determine if statistically different
# weedwrep<- anova_test(CountSum ~ Rep, data=wtab2) # not working for some reason
# weedwrep
# 
```

```{r model weed weight trt vs control}
# first test if treatments are different from control
model.wwt1<- lmer(WeightSum ~ Trt_num + ( 1 | Rep), data=wtab2)
summary(model.wwt1)
anova(model.wwt1)

wwtmean1<- emmeans(model.wwt1, pairwise ~ Trt_num)
wwtmean1
# ctrl 1 & 2 diff from all trts
# no trts diff from each other

plot(wwtmean1)
```

```{r model weed weight trt level, results='hide', message=FALSE, warning=FALSE}
# test if treatments are different from each other
model.wwt2<- lmer(WeightSum ~ Trt_plnt * Trt_crmp + ( 1 | Rep), data=wtab2trt)
summary(model.wwt2)
anova(model.wwt2)

isSingular(model.wwt2)

## model reduction
model.wwt2.best<- get_model(lmerTest::step(model.wwt2, reduce.random=F))
summary(model.wwt2.best)
anova(model.wwt2.best)
### best model: WeightSum ~ (1 | Rep)
```

```{r weed weight model assumptions, results='hide', message=FALSE, warning=FALSE}
# check residuals
resid.model.wwt<- resid(model.wwt2.best)
pred.model.wwt<- predict(model.wwt2.best)

# check randomness
plot(pred.model.wwt, resid.model.wwt, ylab="Residuals", xlab="Weed weights", main="Predictecd vs Residuals") # all in line

# check normality
hist(resid.model.wwt, main="Histogram of Residuals", xlab="Weed weights") # almost all same value

qqnorm(resid.model.wwt) 

# Shapiro-Wilk test
shapiro.test(resid.model.wwt)
# test assumptions not met but no trends
```

```{r weed weight difference of means}
# no main effects
```


### correlation btwn rye biomass & weed biomass

```{r}
# need dataframe with rye biomass & weed biomass data
wtab2 # table of weed biomass

# make rye weight data into table
rtab<- dir %>%
  group_by(Plot, Rep, Trt_num, Trt_plnt, Trt_crmp) %>%
  summarize(Rye_wt)

# combine the two tables
rwtab<- merge(wtab2, rtab, by=c("Plot", "Rep", "Trt_num", "Trt_plnt", "Trt_crmp"))
print(rwtab)

# correlate rye biomass & weed biomass
rwplot<- ggplot(rwtab, aes(x = Rye_wt, y = WeightSum, colour=interaction(Trt_plnt,Trt_crmp))) +
  geom_point(size=3) +
  theme_bw()
print(rwplot)

rwplot<- ggplot(rwtab, aes(x = Rye_wt, y = WeightSum, colour=Trt_plnt)) +
  geom_point(size=3) +
  theme_bw()
print(rwplot)

rwplot<- ggplot(rwtab, aes(x = Rye_wt, y = WeightSum, colour=Trt_crmp)) +
  geom_point(size=3) +
  theme_bw()
print(rwplot)

ggscatter(rwtab, x = "Rye_wt", y = "WeightSum", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Rye biomass", ylab = "Weed biomass")
# weakly negative, not significant

cor.test(rwtab$Rye_wt, rwtab$WeightSum, method="pearson")
```


### correlation btwn marketable corn biomass & weed biomass

```{r}
mtab<- dir %>%
  group_by(Plot, Rep, Trt_num, Trt_plnt, Trt_crmp) %>%
  summarize(W_M_wt)

mwtab<- merge(mtab, wtab2, by=c("Plot", "Rep", "Trt_num", "Trt_plnt", "Trt_crmp"))

ggscatter(mwtab, x = "WeightSum", y = "W_M_wt", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Weed biomass", ylab = "Marketable corn biomass") 
# strongly correlated 

cor.test(mwtab$WeightSum, mwtab$W_M_wt, method="pearson")
# R = -0.8, p = 2.35e-6
```


### comparison of broadleaf & grassy weeds

```{r weed type data modifications, results='hide', message=FALSE, warning=FALSE}
typetab<- dirw %>%
  group_by(Plot, Rep, Trt_num, Trt_plnt, Trt_crmp, Time, Type) %>%
  summarize(typeCount=sum(Count))

typetab2<- subset(dirw, Time=="56DAT") %>%
  group_by(Plot, Rep, Trt_num, Trt_plnt, Trt_crmp, Type) %>%
  summarize(typeWeight=sum(Weight))
```

```{r plot weed types -- counts}
type<- ggplot(typetab, aes(x = Trt_plnt, y = typeCount, fill = Type)) + 
          geom_boxplot() +
          theme_bw()
print(type)
# grasses larger in all rye planting directions & ctrl

type<- ggplot(typetab, aes(x = Trt_crmp, y = typeCount, fill = Type)) + 
          geom_boxplot() +
          theme_bw()
print(type)
# grasses larger in all crimping directions

type<- ggplot(typetab, aes(x = Trt_num, y = typeCount, fill = Type)) + 
          geom_boxplot() +
          theme_bw()
print(type)
# grasses larger in all treatments & controls

type<- ggplot(typetab, aes(x = Time, y = typeCount, fill = Type)) + 
          geom_boxplot() +
          theme_bw()
print(type)
# grasses larger at all time periods
```

```{r plot weed type rep effect -- counts, results='hide', message=FALSE, warning=FALSE}
typerep<- ggplot(typetab, aes(x = Rep, y = typeCount)) +
          geom_boxplot() +
          theme_bw()
print(typerep)
# no apparent rep effects

# anova of reps to determine if statistically different
# typerep<- anova_test(typeCount ~ Rep, data=typetab) # not working for some reason
# typerep
# 
```

```{r plot weed types -- weight}
typew<- ggplot(typetab2, aes(x = Trt_plnt, y = typeWeight, fill = Type)) + 
          geom_boxplot() +
          theme_bw()
print(typew)
# grasses larger in all rye planting directions & ctrl

typew<- ggplot(typetab2, aes(x = Trt_crmp, y = typeWeight, fill = Type)) + 
          geom_boxplot() +
          theme_bw()
print(typew)
# grasses larger in all crimping directions

typew<- ggplot(typetab2, aes(x = Trt_num, y = typeWeight, fill = Type)) + 
          geom_boxplot() +
          theme_bw()
print(typew)
# grasses larger in all treatments & controls
```

```{r plot weed type rep effect -- weight, results='hide', message=FALSE, warning=FALSE}
typewrep<- ggplot(typetab2, aes(x = Rep, y = typeWeight)) +
          geom_boxplot() +
          theme_bw()
print(typewrep)
# no apparent rep effects

# anova of reps to determine if statistically different
# typewrep<- anova_test(typeWeight ~ Rep, data=typetab2) # not working for some reason
# typewrep
# 
```


+ (1 | Year/Rep) + (1 | Location/Rep) + (1 | Year:Location:ID)